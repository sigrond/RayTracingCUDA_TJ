<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>PikeReaderCUDA_TJ: Plik źródłowy D:/Moje dokumenty/RayTracingCUDA_TJ/PikeReader.m</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PikeReaderCUDA_TJ
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Wygenerowano przez Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Szukaj');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Strona&#160;główna</span></a></li>
      <li><a href="pages.html"><span>Dodatkowe&#160;strony</span></a></li>
      <li><a href="namespaces.html"><span>Przestrzenie&#160;nazw</span></a></li>
      <li><a href="annotated.html"><span>Klasy</span></a></li>
      <li class="current"><a href="files.html"><span>Pliki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Szukaj" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Lista&#160;plików</span></a></li>
      <li><a href="globals.html"><span>Składowe&#160;plików</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_pike_reader_8m_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Klasy</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Przestrzenie nazw</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pliki</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Funkcje</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Zmienne</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Definicje typów</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Wyliczenia</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Wartości wyliczeń</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Definicje</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Strony</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PikeReader.m</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_pike_reader_8m.html">Idź do dokumentacji tego pliku.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#acc89f64219ddae53243030f2c645fc06">    1</a></span>&#160;<span class="keyword">function</span> <a class="code" href="_pike_reader_8m.html#acc89f64219ddae53243030f2c645fc06">varargout</a> = PikeReader(varargin)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;%  </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;% </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;% Last Modified by GUIDE v2.5 14-Feb-2016 12:49:44</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;% Begin initialization code - DO NOT EDIT</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;gui_Singleton = 1;</div>
<div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a6c439a155daf0cb0377815c02e9cf72b">    9</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a6c439a155daf0cb0377815c02e9cf72b">gui_State</a> = <span class="keyword">struct</span>(<span class="stringliteral">&#39;gui_Name&#39;</span>,       mfilename, ...</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                   <span class="stringliteral">&#39;gui_Singleton&#39;</span>,  gui_Singleton, ...</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                   <span class="stringliteral">&#39;gui_OpeningFcn&#39;</span>, @PikeReader_OpeningFcn, ...</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                   <span class="stringliteral">&#39;gui_OutputFcn&#39;</span>,  @PikeReader_OutputFcn, ...</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                   <span class="stringliteral">&#39;gui_LayoutFcn&#39;</span>,  [] , ...</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                   <span class="stringliteral">&#39;gui_Callback&#39;</span>,   []);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keywordflow">if</span> nargin &amp;&amp; <a class="code" href="_pike_reader_8m.html#aae1d1bec0e9c36c2fddc5cd87d8c4eee">ischar</a>(varargin{1})</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a class="code" href="_pike_reader_8m.html#a6c439a155daf0cb0377815c02e9cf72b">gui_State</a>.gui_Callback = str2func(varargin{1});</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;end</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keywordflow">if</span> <a class="code" href="_pike_reader_8m.html#a9b07119da70fc4a54e0d1cb5751d69aa">nargout</a></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a9b07119da70fc4a54e0d1cb5751d69aa">   20</a></span>&#160;    [varargout{1:nargout}] = <a class="code" href="_pike_reader_8m.html#a58f7f5bb8af524fdfac53ec31e329e3f">gui_mainfcn</a>(<a class="code" href="_pike_reader_8m.html#a6c439a155daf0cb0377815c02e9cf72b">gui_State</a>, varargin{:});</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordflow">else</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <a class="code" href="_pike_reader_8m.html#a58f7f5bb8af524fdfac53ec31e329e3f">gui_mainfcn</a>(<a class="code" href="_pike_reader_8m.html#a6c439a155daf0cb0377815c02e9cf72b">gui_State</a>, varargin{:});</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;end</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;% End initialization code - DO NOT EDIT</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;% --- Executes just before PikeReader is made visible.</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> PikeReader_OpeningFcn(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>, eventdata, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>, varargin)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;% This <a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> has no output <a class="code" href="_pike_reader_8m.html#aa75144726b375b93ecfc08810e5b5f09">args</a>, see OutputFcn.</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;% <a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>    handle to <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;% <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>    structure with <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> and user data (see GUIDATA)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;% varargin   command line arguments to PikeReader (see VARARGIN)</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;% Choose default command line output for PikeReader</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.output = <a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a53323a4c01bdc9e45b28410b296cb054">   37</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn = [];</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#add07a252dc3f8e8cc0dac2890c4e6fac">   38</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.sF = [];</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a698dc751c8784604904c64b677c04a3f">   39</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl = [];</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ae497c72ae3643e1d411e9ccbd1291a19">   40</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hImSh = []; % <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> to imshow <span class="keywordtype">object</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a0c5581292ad1231b0c279aa0e16f09d9">   41</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a0c5581292ad1231b0c279aa0e16f09d9">Frame</a> = FrameRider(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aec2eeebd8d646ee2ebc719f72c9c7347">   42</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.cF = <a class="code" href="_pike_reader_8m.html#a0c5581292ad1231b0c279aa0e16f09d9">Frame</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">   43</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S = SetSystem;    </div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ade5833a0a85b9b718569df8e6db987da">   44</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.TshX = 0;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a903dc30acce65e0358386b3e2e59d2ef">   45</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX  = 0;</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a620c5047f94fcde614026a5718963c8b">   46</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.TshY = 0;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aed35f423ca9aba8635f1fd5e4df75a65">   47</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY  = 0;</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a85b8167c96f99aa3837bc38e9bf96eb3">   48</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.LW   = 0;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ab9f9228dbcac2043ba4424e683ffc8b6">   49</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shLW = 0;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;% <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> <span class="keywordflow">for</span> masks</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a2aedde79552f40449090018d231fa562">   51</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.BWR = [];</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a2f93ba66296f970945973536ac7bfa87">   52</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.BWG = [];</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ada0d3b3c6dbb4f469da7e20a519437fd">   53</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.BWB = [];</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">   55</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.GPU=1;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.edAperture,<span class="stringliteral">&#39;string&#39;</span>,num2str(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.D));</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.edPdrop,<span class="stringliteral">&#39;string&#39;</span>,num2str(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.Pk));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.edCCD,<span class="stringliteral">&#39;string&#39;</span>,[num2str(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.lCCD),<span class="stringliteral">&#39;, 0&#39;</span>,<span class="stringliteral">&#39;, 0&#39;</span>]);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.ed_Sh_l1,<span class="stringliteral">&#39;string&#39;</span>, num2str( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.l1 ) );</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">   61</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> = Draw(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;% Update <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> structure</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;% UIWAIT makes PikeReader wait <span class="keywordflow">for</span> user <a class="code" href="_pike_reader_8m.html#aefc58e2aa2fcd319de777ecd3067fdd9">response</a> (see UIRESUME)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;% <a class="code" href="_pike_reader_8m.html#a67860ef9c6dd010302334f9c5a53f7b3">uiwait</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.Fig1);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;% --- Outputs from this <a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> are returned to the command line.</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> <a class="code" href="_pike_reader_8m.html#acc89f64219ddae53243030f2c645fc06">varargout</a> = PikeReader_OutputFcn(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>, eventdata, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>) </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;% <a class="code" href="_pike_reader_8m.html#acc89f64219ddae53243030f2c645fc06">varargout</a>  cell array for returning output <a class="code" href="_pike_reader_8m.html#aa75144726b375b93ecfc08810e5b5f09">args</a> (see VARARGOUT);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;% <a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>    handle to <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a></div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a7c1ef7386988a8ccd4761d8428895842">   73</a></span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;% <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>    structure with <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> and user data (see GUIDATA)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;% Get default command line output from <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> structure</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<a class="code" href="_pike_reader_8m.html#acc89f64219ddae53243030f2c645fc06">varargout</a>{1} = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.output;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;%% My <a class="code" href="_pike_reader_8m.html#a77daacf149ab4ea47290c71d79d2c783">functions</a></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a77daacf149ab4ea47290c71d79d2c783">   79</a></span>&#160;%=============== My <a class="code" href="_pike_reader_8m.html#a77daacf149ab4ea47290c71d79d2c783">functions</a> =========================================</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">function</span> <a class="code" href="_pike_reader_8m.html#a0c5581292ad1231b0c279aa0e16f09d9">Frame</a> = FrameRider(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;% reads <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> from movie -&gt;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;if <a class="code" href="_pike_reader_8m.html#ab0f73a4b0e20ffee1dff4c2e0add81c0">isempty</a>( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn )</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;%     In <span class="keywordflow">case</span> when movie is not loaded</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;     <a class="code" href="_pike_reader_8m.html#a0c5581292ad1231b0c279aa0e16f09d9">Frame</a> = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>(480,640,3);   </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keywordflow">else</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a7a344eb254d5f989a285b2afbb5e10d9">   86</a></span>&#160;     <a class="code" href="_pike_reader_8m.html#a7a344eb254d5f989a285b2afbb5e10d9">mov</a> = AviReadPike_Split( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.nom );</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;     %<a class="code" href="_pike_reader_8m.html#a3c6a1673d3a361dfaace22b908b602d4">munlock</a>(<span class="stringliteral">&#39;avimex_Split&#39;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;     %<a class="code" href="_pike_reader_8m.html#a972c98ca59d4bab0dafff435513cdbb4">clear</a>(<span class="stringliteral">&#39;avimex_Split&#39;</span>);</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a9298037979afd4748a15c04dbf4dad7b">   89</a></span>&#160;     %<a class="code" href="_pike_reader_8m.html#a972c98ca59d4bab0dafff435513cdbb4">clear</a> <a class="code" href="_pike_reader_8m.html#a9298037979afd4748a15c04dbf4dad7b">mex</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;     %<a class="code" href="_pike_reader_8m.html#a972c98ca59d4bab0dafff435513cdbb4">clear</a> <a class="code" href="_pike_reader_8m.html#a77daacf149ab4ea47290c71d79d2c783">functions</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;     Frame =  single(squeeze( <a class="code" href="_pike_reader_8m.html#a7a344eb254d5f989a285b2afbb5e10d9">mov</a> ));</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aadd84b46ee6d2e3ae04d2920f4e78bfd">   92</a></span>&#160;     %<a class="code" href="_pike_reader_8m.html#aadd84b46ee6d2e3ae04d2920f4e78bfd">drawnow</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;     %<a class="code" href="_pike_reader_8m.html#af5e7b6b3888b7ff1427978d360412fe7">pause</a>(0.1);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;end</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;% ---------------------------------------------------------------------</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> = Draw(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        %  draws image</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.chSumFrames,&#39;value&#39;)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        % <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a> <a class="code" href="_ray_tracing_8m.html#a9564846b4818d9eed8b0e902c97b942d">sum</a> frames</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> ~<a class="code" href="_pike_reader_8m.html#ab0f73a4b0e20ffee1dff4c2e0add81c0">isempty</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#add07a252dc3f8e8cc0dac2890c4e6fac">sF</a>)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <a class="code" href="_pike_reader_8m.html#a905c521e05ec8042631a912b71d0454e">temp</a> = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#add07a252dc3f8e8cc0dac2890c4e6fac">sF</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">  104</a></span>&#160;            % <span class="keywordflow">if</span> there isn<span class="stringliteral">&#39;t sum of frame, then draws current frame instead</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#af4be304c83f888a0a39ed37c6f930fa3">  105</a></span>&#160;<span class="stringliteral">            h = errordlg(&#39;</span>Sum <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> Frames not found<span class="charliteral">&#39;,&#39;</span>Sum Error<span class="stringliteral">&#39;); uiwait(h);</span></div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a905c521e05ec8042631a912b71d0454e">  106</a></span>&#160;<span class="stringliteral">            temp = handles.cF;</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">            set(handles.chSumFrames,&#39;</span>value<span class="stringliteral">&#39;,0)</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral">    else</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral">        % get current frame</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="stringliteral">        temp = handles.cF;</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="stringliteral">    Frame =  zeros(size(temp));</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral">    % Choosing the channel of observation </span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral">    if get(handles.chR,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral">        Frame(:,:,1) = temp(:,:,1);</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="stringliteral">    if get(handles.chG,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral">        Frame(:,:,2) = temp(:,:,2);</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="stringliteral">    if get(handles.chB,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="stringliteral">        Frame(:,:,3) = temp(:,:,3);</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral">    % Correction of the level of intensity</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="stringliteral">    if get(handles.chAdjust,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="stringliteral">        Frame = Frame.*str2double( get(handles.edAdjust,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a7ca9388205808cde238c5d87083a3f02">  128</a></span>&#160;<span class="stringliteral">    % If there is no path, then show the empty frame</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">    if isempty( handles.hImSh )</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral">        if isempty( handles.fn )</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="stringliteral">           handles.hImSh = imshow( handles.cF);</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">        else</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">           handles.hImSh = imshow(uint16(Frame));</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="stringliteral">        if isempty(handles.hl)</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="stringliteral">            hold on;</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="stringliteral">            % first channel</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="stringliteral">            handles.hl(1) = plot( [0, 0],[0, 0],&#39;</span>color<span class="stringliteral">&#39;,[0.9,0.9,0.9] ); % The red channel</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="stringliteral">            % additional vertical lines</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="stringliteral">            handles.hl(2) = plot( [0, 0],[0, 0],&#39;</span>color<span class="stringliteral">&#39;,[0.9,0.9,0.9] );</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral">            handles.hl(3) = plot( [0, 0],[0, 0],&#39;</span>color<span class="stringliteral">&#39;,[0.9,0.9,0.9] );</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="stringliteral">            % second channel</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">            handles.hl(4) = plot( [0, 0],[0, 0],&#39;</span>color<span class="charliteral">&#39;,&#39;</span>r<span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="stringliteral">            handles.hl(5) = plot( [0, 0],[0, 0],&#39;</span>color<span class="charliteral">&#39;,&#39;</span>r<span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">            handles.hl(6) = plot( [0, 0],[0, 0],&#39;</span>color<span class="charliteral">&#39;,&#39;</span>r<span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">            % third channel</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral">            handles.hl(7) = plot( [0, 0],[0, 0],&#39;</span>color<span class="charliteral">&#39;,&#39;</span><a class="code" href="_set_system_8m.html#a86bdec0d61a48a8ca4da1674058837cc">g</a><span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">            handles.hl(8) = plot( [0, 0],[0, 0],&#39;</span>color<span class="charliteral">&#39;,&#39;</span><a class="code" href="_set_system_8m.html#a86bdec0d61a48a8ca4da1674058837cc">g</a><span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral">            handles.hl(9) = plot( [0, 0],[0, 0],&#39;</span>color<span class="charliteral">&#39;,&#39;</span><a class="code" href="_set_system_8m.html#a86bdec0d61a48a8ca4da1674058837cc">g</a><span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a835accca41274fb237599d9b3c117fcf">  150</a></span>&#160;<span class="stringliteral">            hold off;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">            guidata(hObject, handles);</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">    else</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">        if isempty( handles.fn )</span></div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ac2529c9aa0e86fba892de797e252c223">  155</a></span>&#160;<span class="stringliteral">           set(handles.hImSh,&#39;</span><a class="code" href="_pike_reader_8m.html#ac2529c9aa0e86fba892de797e252c223">Cdata</a><span class="stringliteral">&#39;,handles.cF);</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">        else</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">           set(handles.hImSh,&#39;</span><a class="code" href="_pike_reader_8m.html#ac2529c9aa0e86fba892de797e252c223">Cdata</a><span class="stringliteral">&#39;,uint16(Frame));</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">    % If sight checkbox is active then draw theoretical image</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="stringliteral">    if get(handles.chSight,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral">       </span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">        % setting the wavelength value</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="stringliteral">        if get(handles.chR,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">  165</a></span>&#160;<span class="stringliteral">            handles.S.lambda = str2double(get(handles.edR,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#adca714bf61ad7fb2fc07053ed7c43d40">  166</a></span>&#160;<span class="stringliteral">            handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;</span><a class="code" href="_calculate__m_8m.html#a5a182ddedd82ee46f83d0aca23119410">BK7</a><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aa873351ac7745f560c49f5d18d1f02f1">  167</a></span>&#160;<span class="stringliteral">            handles.ChKey = 1;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="stringliteral">            guidata(hObject,handles);</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="stringliteral">                handles = Sight(hObject,handles);</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="stringliteral">        else</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="stringliteral">            set(handles.hl(1),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="stringliteral">            set(handles.hl(2),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="stringliteral">            set(handles.hl(3),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="stringliteral">        if get(handles.chG,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="stringliteral">            handles.S.lambda = str2double(get(handles.edG,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="stringliteral">            handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;</span><a class="code" href="_calculate__m_8m.html#a5a182ddedd82ee46f83d0aca23119410">BK7</a><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="stringliteral">             handles.ChKey = 2;</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="stringliteral">             guidata(hObject,handles);</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="stringliteral">                handles = Sight(hObject,handles);</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="stringliteral">               </span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="stringliteral">        else</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral">            set(handles.hl(4),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="stringliteral">            set(handles.hl(5),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral">            set(handles.hl(6),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="stringliteral">        if get(handles.chB,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="stringliteral">            handles.S.lambda = str2double(get(handles.edB,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral">             handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;</span><a class="code" href="_calculate__m_8m.html#a5a182ddedd82ee46f83d0aca23119410">BK7</a><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="stringliteral">             handles.ChKey = 3;</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral">            guidata(hObject,handles);</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral">                handles = Sight(hObject,handles);</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral">        else</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="stringliteral">            set(handles.hl(7),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="stringliteral">            set(handles.hl(8),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral">            set(handles.hl(9),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">        guidata(hObject,handles)</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">% ---------------------------------------------------------------------</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">function handles = Sight(hObject,handles)</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral"> </span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral"> % setting the droplet&#39;</span><a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> position</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.Pk = str2num(<span class="keyword">get</span>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.edPdrop,<span class="stringliteral">&#39;string&#39;</span>));</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; % setting the CCD<span class="stringliteral">&#39;s position</span></div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ab44ef72087855f33a3f7f9c0734467fd">  206</a></span>&#160;<span class="stringliteral"> vel = str2num(get(handles.edCCD,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a329bdf08e8a16fe125c697c185d9725e">  207</a></span>&#160;<span class="stringliteral">  handles.S.lCCD = vel(1);</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="stringliteral">  handles.shX = vel(2);</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="stringliteral">  handles.shY = vel(3);</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="stringliteral">  % setting the effective aperture</span></div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a4ac4099d01190890df161d528ebb7bef">  211</a></span>&#160;<span class="stringliteral">  handles.S.efD = str2double(get(handles.edAperture,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral">  % setting the position of additional line</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">  handles.shLW = str2double(get(handles.edLineSh,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a8ed6ac5cbd6e13e4eadfda44f8d995b8">  214</a></span>&#160;<span class="stringliteral">  handles.S.CCDH = handles.S.CCDPH * handles.S.PixSize;  % height of CCD</span></div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a9349b39d3b86ed6b44272d93479cb559">  215</a></span>&#160;<span class="stringliteral">  handles.S.CCDW = handles.S.CCDPW * handles.S.PixSize;  % width  of CCD</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral">  % setting the distance between center of the trap and  first lens</span></div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a091dd2547d36e2b58e43462d965834d7">  217</a></span>&#160;<span class="stringliteral">  handles.S.l1   = str2double( get( handles.ed_Sh_l1,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39; ) );</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">handles = DrawTheorImage(hObject,handles);</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">guidata(hObject,handles);</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">%-------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">function Br = BorderCreation(hObject,handles)</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral">% This function creates border points. The position of border points depends on geometry</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral">% of trap and droplet&#39;</span><a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> position.</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;% Trap center coincides with the center <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;% the coordinate system</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;%</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a> = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>(4*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,3);       % vector <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> border points</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;% <a class="code" href="_pike_reader_8m.html#a33cb10e751a17a81c39b07c9dc1710ae">calculation</a> <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> position <span class="keywordflow">for</span> the 4 outer points</div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a698703b15037a73ef893d58e89410e1f">  230</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a698703b15037a73ef893d58e89410e1f">alpha</a> = asin(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.dW/2/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.R_midl_El);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;[X(1),Y(1)] = pol2cart(<a class="code" href="_pike_reader_8m.html#a698703b15037a73ef893d58e89410e1f">alpha</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.R_midl_El);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;[X(2),Y(2)] = pol2cart(-<a class="code" href="_pike_reader_8m.html#a698703b15037a73ef893d58e89410e1f">alpha</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.R_midl_El);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<a class="code" href="_pike_reader_8m.html#a2e13bf91d03a85943c3365be0dc8173a">Z</a>(1) = -<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a483471d881ab668d2b0837db0515bfb3">dH</a>/2;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<a class="code" href="_pike_reader_8m.html#a2e13bf91d03a85943c3365be0dc8173a">Z</a>(2) = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.dH/2;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(1,:) = [X(1),Y(1),Z(1)];</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(2,:) = [X(1),Y(1),Z(2)];</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(3,:) = [X(2),Y(2),Z(2)];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(4,:) = [X(2),Y(2),Z(1)];</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">  240</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a> = <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(4,:) - <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>; % <a class="code" href="_pike_reader_8m.html#afe64baaef30e37f64cb283b533dd6e8f">left</a> (or right) border</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<a class="code" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a> = V/<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(V);</div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">  242</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a> = <a class="code" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a>(1)^2 + V(2)^2;</div>
<div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">  243</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a> = 2*(<a class="code" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a>(1)*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.Pk(1)+V(2)*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>(2));</div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aaa53ca0b650dfd85c4f59fa156f7a2cc">  244</a></span>&#160;<a class="code" href="_pike_reader_8m.html#aaa53ca0b650dfd85c4f59fa156f7a2cc">C</a> = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.Pk(1)^2 + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>(2)^2 - (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a92194e0fd585cf13a4a3b76420356158">R_dis_Ring</a>)^2;</div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a350bfcb1e3cfb28ddff48ce525d4f139">  245</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a> = <a class="code" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a>^2-4*<a class="code" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a>*<a class="code" href="_pike_reader_8m.html#aaa53ca0b650dfd85c4f59fa156f7a2cc">C</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">  246</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a> = (-<a class="code" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a>+sqrt(<a class="code" href="_pike_reader_8m.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a>) )/2/<a class="code" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(5,:) = [ handles.S.Pk(1)+V(1)*t handles.S.Pk(2)+V(2)*t -handles.S.dH/2];</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;V = <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(1,:) - <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>; % <a class="code" href="_pike_reader_8m.html#afe64baaef30e37f64cb283b533dd6e8f">left</a> (or right) border</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;V = V/<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(V);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<a class="code" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a> = <a class="code" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a>(1)^2 + V(2)^2;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<a class="code" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a> = 2*(<a class="code" href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a>(1)*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.Pk(1)+V(2)*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>(2));</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<a class="code" href="_pike_reader_8m.html#aaa53ca0b650dfd85c4f59fa156f7a2cc">C</a> = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.Pk(1)^2 + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>(2)^2 - (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a92194e0fd585cf13a4a3b76420356158">R_dis_Ring</a>)^2;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<a class="code" href="_pike_reader_8m.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a> = <a class="code" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a>^2-4*<a class="code" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a>*<a class="code" href="_pike_reader_8m.html#aaa53ca0b650dfd85c4f59fa156f7a2cc">C</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a> = (-<a class="code" href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a>+sqrt(<a class="code" href="_pike_reader_8m.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a>) )/2/<a class="code" href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(6,:) = [ handles.S.Pk(1)+V(1)*t handles.S.Pk(2)+V(2)*t -handles.S.dH/2];</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(7,1:2) = <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(6,1:2);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(7,3)   = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.dH/2;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(8,1:2) = <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(5,1:2);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(8,3)   = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.dH/2;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;%</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(1:<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,1) = ones(1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N)*<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(1,1);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(1:<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,2) = ones(1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N)*<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(1,2);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(1:<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,3) = linspace(<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(2,3),<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(1,3),<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N);</div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a012f41a4e178ac7e193a1a250962f349">  267</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a012f41a4e178ac7e193a1a250962f349">V1</a> = <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(6,:); % directing vector from origin to <a class="code" href="_pike_reader_8m.html#ad51c447b242fd7b0935d39a878faf3cb">point</a> 6</div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a5b2ed5ea2e1cb5d4cbbfab8a4366ed76">  268</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a5b2ed5ea2e1cb5d4cbbfab8a4366ed76">V2</a> = <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(5,:); % directing vector from origin to <a class="code" href="_pike_reader_8m.html#ad51c447b242fd7b0935d39a878faf3cb">point</a> 5</div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a2f9cb71a5dadd05cb10a4b34b09130a0">  269</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a2f9cb71a5dadd05cb10a4b34b09130a0">Bt1</a> = acos( dot( <a class="code" href="_pike_reader_8m.html#a012f41a4e178ac7e193a1a250962f349">V1</a>(1:2) ,[1,0])/<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>( <a class="code" href="_pike_reader_8m.html#a012f41a4e178ac7e193a1a250962f349">V1</a>(1:2) ));</div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a5fbc4fbf26631ee45e428d05d93fee86">  270</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a5fbc4fbf26631ee45e428d05d93fee86">Bt2</a> = acos( dot(<a class="code" href="_pike_reader_8m.html#a5b2ed5ea2e1cb5d4cbbfab8a4366ed76">V2</a>(1:2),[1,0])/<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(<a class="code" href="_pike_reader_8m.html#a5b2ed5ea2e1cb5d4cbbfab8a4366ed76">V2</a>(1:2)));</div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad1367ffd245743f6db78ce58d9d877c4">  271</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ad1367ffd245743f6db78ce58d9d877c4">VBt</a> = linspace(<a class="code" href="_pike_reader_8m.html#a2f9cb71a5dadd05cb10a4b34b09130a0">Bt1</a>,-<a class="code" href="_pike_reader_8m.html#a5fbc4fbf26631ee45e428d05d93fee86">Bt2</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;%</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;[X,Y] = pol2cart(<a class="code" href="_pike_reader_8m.html#ad1367ffd245743f6db78ce58d9d877c4">VBt</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.R_dis_Ring);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):2*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,1) = <a class="code" href="_ray_tracing_8m.html#aee34fc740f3a5271508e6499ce2e3326">X</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):2*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,2) = Y;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):2*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,3) = -ones(1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">N</a>)*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a483471d881ab668d2b0837db0515bfb3">dH</a>/2;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((2*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):3*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,1) = ones(1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N)*<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(4,1);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((2*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):3*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,2) = ones(1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N)*<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(4,2);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((2*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):3*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,3) = linspace(<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(4,3),<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>(3,3),<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<a class="code" href="_pike_reader_8m.html#ad1367ffd245743f6db78ce58d9d877c4">VBt</a> = linspace(-<a class="code" href="_pike_reader_8m.html#a5fbc4fbf26631ee45e428d05d93fee86">Bt2</a>,<a class="code" href="_pike_reader_8m.html#a2f9cb71a5dadd05cb10a4b34b09130a0">Bt1</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;%</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;[X,Y] = pol2cart(<a class="code" href="_pike_reader_8m.html#ad1367ffd245743f6db78ce58d9d877c4">VBt</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.R_dis_Ring);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((3*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):4*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,1) = <a class="code" href="_ray_tracing_8m.html#aee34fc740f3a5271508e6499ce2e3326">X</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((3*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):4*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,2) = Y;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>((3*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N+1):4*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N,3) = ones(1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N)*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.dH/2;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;%-------------------------------------------------------------------------</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> = DrawTheorImage(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;% generation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> border points</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a> = <a class="code" href="_pike_reader_8m.html#aaa03ee2d9c5e52d9a5afa7b300071b6f">BorderCreation</a>(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;% ray tracing <a class="code" href="_pike_reader_8m.html#a33cb10e751a17a81c39b07c9dc1710ae">calculation</a></div>
<div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">  294</a></span>&#160;<span class="keywordflow">for</span> <a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 1:<a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.Br,1)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;       <a class="code" href="_pike_reader_8m.html#abce4d39eb0932a7a185d66f28b529a9b">Pd</a> = [ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(<a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>,1), <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(i,2), <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(i,3) ]; % Points on the diaphragm plane </div>
<div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">  296</a></span>&#160;       <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a> = RayTracing(<a class="code" href="_pike_reader_8m.html#abce4d39eb0932a7a185d66f28b529a9b">Pd</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;%              <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a>(<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>,1) == 7</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                 <a class="code" href="_pike_reader_8m.html#ab52db955259a3fd3904e2eeac8aeea17">W1</a>(i) = P(7,2);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                 <a class="code" href="_pike_reader_8m.html#a6547474af60ce2b5078438090a689969">Hi1</a>(i) = P(7,3);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;%              else </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;              % Terminate the rays that don&#39;<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a> hit the CCD element   </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;%                  <a class="code" href="_pike_reader_8m.html#ab52db955259a3fd3904e2eeac8aeea17">W1</a>(i) = NaN;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;%                  <a class="code" href="_pike_reader_8m.html#a6547474af60ce2b5078438090a689969">Hi1</a>(i) = NaN;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;%              end</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; end</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;% Recalculation meters to pixels</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;% shifting the  origin to middle <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> the image.</div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad51c447b242fd7b0935d39a878faf3cb">  308</a></span>&#160;% The center <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> image isn&#39;<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a> placed  on [0,0] <a class="code" href="_pike_reader_8m.html#ad51c447b242fd7b0935d39a878faf3cb">point</a>, but on [240,320] point</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a3640ad397933061adc052c623140eef9">R1</a>(1,:) = (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_pike_reader_8m.html#a9349b39d3b86ed6b44272d93479cb559">CCDW</a>/2 + <a class="code" href="_pike_reader_8m.html#ab52db955259a3fd3904e2eeac8aeea17">W1</a>)/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_set_system_8m.html#a141992195c618a3c78b87ed867206a34">PixSize</a>;  % [ Pix ]</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(2,:) = (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_pike_reader_8m.html#a8ed6ac5cbd6e13e4eadfda44f8d995b8">CCDH</a>/2 + <a class="code" href="_pike_reader_8m.html#a6547474af60ce2b5078438090a689969">Hi1</a>)/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.PixSize; % [ Pix ]</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;% drawing the additional symetrical lines</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">  313</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">N</a> = 20;</div>
<div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#adb6132df0fb2f5a14569df7e2c5394e1">  314</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#adb6132df0fb2f5a14569df7e2c5394e1">LH</a> = linspace(-<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_set_system_8m.html#a483471d881ab668d2b0837db0515bfb3">dH</a>/2,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.dH/2,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N);</div>
<div class="line"><a name="l00315"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a3956b937b791b918837824f48ee12586">  315</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a3956b937b791b918837824f48ee12586">L</a> = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>(2,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#abf9d47cd7d4fbc942e618bb1977019c2">  317</a></span>&#160;for <a class="code" href="_pike_reader_8m.html#abf9d47cd7d4fbc942e618bb1977019c2">ii</a> = 1:<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; Pd = [ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.ld, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a85b8167c96f99aa3837bc38e9bf96eb3">LW</a> + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ab9f9228dbcac2043ba4424e683ffc8b6">shLW</a>, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#adb6132df0fb2f5a14569df7e2c5394e1">LH</a>(<a class="code" href="_pike_reader_8m.html#abf9d47cd7d4fbc942e618bb1977019c2">ii</a>) ];</div>
<div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#af93dd7f73e57b8b17d34efa33f0f948e">  319</a></span>&#160;         <a class="code" href="_pike_reader_8m.html#af93dd7f73e57b8b17d34efa33f0f948e">P1</a> = RayTracing(Pd,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;         <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a3956b937b791b918837824f48ee12586">L</a>(1,ii)= (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_pike_reader_8m.html#a9349b39d3b86ed6b44272d93479cb559">CCDW</a>/2 + <a class="code" href="_pike_reader_8m.html#af93dd7f73e57b8b17d34efa33f0f948e">P1</a>(7,2))/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.PixSize;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;         <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(2,ii)= (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_pike_reader_8m.html#a8ed6ac5cbd6e13e4eadfda44f8d995b8">CCDH</a>/2 + P1(7,3))/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.PixSize;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;         </div>
<div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#abce4d39eb0932a7a185d66f28b529a9b">  323</a></span>&#160; Pd = [ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.ld, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a85b8167c96f99aa3837bc38e9bf96eb3">LW</a> - <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shLW, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#adb6132df0fb2f5a14569df7e2c5394e1">LH</a>(ii) ];</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;         P1 = RayTracing(Pd,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;         <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(3,ii)= (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_pike_reader_8m.html#a9349b39d3b86ed6b44272d93479cb559">CCDW</a>/2 + P1(7,2))/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.PixSize;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;         <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(4,ii)= (<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.<a class="code" href="_pike_reader_8m.html#a8ed6ac5cbd6e13e4eadfda44f8d995b8">CCDH</a>/2 + P1(7,3))/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.PixSize;        </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;end</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;switch <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#aa873351ac7745f560c49f5d18d1f02f1">ChKey</a></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    case 1 % Red channel</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a698dc751c8784604904c64b677c04a3f">hl</a>(1),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(1,:) +  <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a903dc30acce65e0358386b3e2e59d2ef">shX</a>,...</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(2,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#aed35f423ca9aba8635f1fd5e4df75a65">shY</a> );</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(2),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(1,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(2,:)+ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(3),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(3,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(4,:)+ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    case 2</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(4),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(1,:) +  <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(2,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY );</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(5),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(1,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(2,:)+ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(6),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(3,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(4,:)+ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    case 3</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(7),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(1,:) +  <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.R1(2,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(8),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(1,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(2,:)+ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;         <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.hl(9),&#39;xdata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(3,:) + <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shX,...</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                           &#39;ydata&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.L(4,:)+ <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.shY);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;end</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;%----------------------------------------------------------------------</div>
<div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#adbb3dedcc987c432a0facce1bdf57cb5">  355</a></span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> [<a class="code" href="_pike_reader_8m.html#a1123044b2487d93ac4f2068652cbfb8c">IC</a>,<a class="code" href="_pike_reader_8m.html#adbb3dedcc987c432a0facce1bdf57cb5">THETA</a>,<a class="code" href="_pike_reader_8m.html#aa9c19988f200a79e3fa5bf1f1dd3d816">PHI</a>] =  IC_Calculation(hObject,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;% The IC_Calculation <a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a>, calculates </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;% intensity correction <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> for experimental data.       </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;%% Creation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> electrode border</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;%% <a class="code" href="_pike_reader_8m.html#a51d4a2ecbc1a31c6a187269dae7c1ef9">FIXME</a>: could be sped up!!! with <a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>  </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;%<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N = 3e3; % Number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points per side</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.N = 25000; %5e2 ; % Number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points per side</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a7ab10073dde4b253ad2f8fead0e352b8">  363</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a7ab10073dde4b253ad2f8fead0e352b8">KA1</a>=zeros(20,20);</div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a3b1f2de14b8a6c0b78d815e608e45a8a">  364</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a3b1f2de14b8a6c0b78d815e608e45a8a">KA2</a>=zeros(20,20);</div>
<div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aa656899df1f8926fc8507851b84bf381">  365</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#aa656899df1f8926fc8507851b84bf381">KA3</a>=zeros(20,20);</div>
<div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ac4ca50a39233ee7f03b0e8ec074a7be0">  366</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#ac4ca50a39233ee7f03b0e8ec074a7be0">KA4</a>=zeros(20,20);</div>
<div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a38085a9efe80800b5ff4a73688322798">  367</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a38085a9efe80800b5ff4a73688322798">KA5</a>=zeros(20,20);</div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a29ecbdb426abecbcedbd450486d5ded2">  368</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a29ecbdb426abecbcedbd450486d5ded2">KA6</a>=zeros(20,20);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;%<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>=0;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.GPU==1</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a> = single(<a class="code" href="_pike_reader_8m.html#aaa03ee2d9c5e52d9a5afa7b300071b6f">BorderCreation</a>(hObject,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>));</div>
<div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#afc718730e782c562dbdd8cbdda84fb46">  373</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#afc718730e782c562dbdd8cbdda84fb46">Vb</a> = (1 + handles.S.N ) : handles.S.N * 2;</div>
<div class="line"><a name="l00374"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a1123044b2487d93ac4f2068652cbfb8c">  374</a></span>&#160;    IC = single(zeros(480,640));</div>
<div class="line"><a name="l00375"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a4624ad09721d379eb37b97070c9259c4">  375</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a4624ad09721d379eb37b97070c9259c4">PX</a> = single(zeros(4,480,640));</div>
<div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a8fb092330ecda60587643305d0d9738a">  376</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a8fb092330ecda60587643305d0d9738a">tic</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    %pojawia si dziwny crash matlaba dla koloru niebieskiego
    %na SPICA&#39;y nie udao mi si go odtworzy
    %zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu
    %nie wiem dlaczego tak si dzieje, ale moe by to bug w matlabie
    %edit: bd by zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
 dziwny crash matlaba dla koloru niebieskiego</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    %na SPICA&#39;y nie udao mi si go odtworzy
    %zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu
    %nie wiem dlaczego tak si dzieje, ale moe by to bug w matlabie
    %edit: bd by zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
 go odtworzy     %zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu
    %nie wiem dlaczego tak si dzieje, ale moe by to bug w matlabie
    %edit: bd by zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    %zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu</div>
<div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">  380</a></span>&#160;    %nie wiem dlaczego tak si dzieje, ale moe by to bug w matlabie
    %edit: bd by zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
 <a class="code" href="_pike_reader_8m.html#a9d0c75b43300c189035103c63a8aeb08">dzieje</a>, ale moe by to bug w matlabie
    %edit: bd by zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
 to bug w matlabie</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a>: bd by zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
 zwizany z nie sprawdzaniem, czy promie nie wyszed
    %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
 nie wyszed     %poza macierz
    [IC,PX]=RayTracingCUDA(Br(Vb(1,:),1), Br(Vb(1,:),2), Br(:,3),handles);
    toc
    %[IC,PX]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);
    %max(IC);
    ICNNT=IC;

    IC = IC./max(IC(:));
    
    imtool(IC);
    figure;
    mesh(double(IC));
    
    %PXX=PX(1,1:10,1:10)./PX(4,1:10,1:10)
    PXX=PX(1,:,:)./PX(4,:,:);
    PXX=squeeze(PXX);
    %size(PXX)
    %imtool(PXX);
    PXY=PX(2,:,:)./PX(4,:,:);
    PXY=squeeze(PXY);
    %imtool(PXY);
    PXZ=PX(3,:,:)./PX(4,:,:);
    PXZ=squeeze(PXZ);
    %imtool(PXZ);

    %[THETA,PHI,R] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));
    [THETA,PHI,R] = cart2sph(PXX,PXY,PXZ);
    %imtool(THETA);
    %imtool(PHI);
    %imtool(R);
    ICT=IC;
    THETAT=THETA;
    PHIT=PHI;
    RT=R;
    PXXT=PXX;
    PXYT=PXY;
    PXZT=PXZ;
    %save(&#39;compT.mat&#39;,&#39;ICT&#39;,&#39;THETAT&#39;,&#39;PHIT&#39;,&#39;RT&#39;,&#39;PXXT&#39;,&#39;PXYT&#39;,&#39;PXZT&#39;,&#39;ICNNT&#39;);
else
handles.S.N = 3e3; % Number of points per side
Br = single(BorderCreation(hObject,handles));
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode

IC = single(zeros(480,640));   % Declaration of correction matrix
PX = single(zeros(480,640,4)); % Declaration of pixel position matrix 
                       % PX(X,Y,Nom); Where Nom is a number of rays that
                       % walk into cell
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);
s = &#39;Time estimation...&#39;;
for i = 1 : length(Vb)    % The movment across Z axis
    waitbar(i/length(Vb),hwb,s);
    tic;
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
              % shifting of mask position according experimental data
                 W  =  handles.shX + ( handles.S.CCDW/2 +P(7,2))/handles.S.PixSize; 
                 Hi =  handles.shY + (handles.S.CCDH/2 +P(7,3))/handles.S.PixSize;
               % Recording position of rays and a number of rays that
               % walk into the cell
               
                 PX(round(Hi),round(W),1) = PX(round(Hi),round(W),1) + P(2,1);
                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);
                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);
                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;
         % The calculation of energy loss,  caused by reflection on lens surfaces
         % and rising distance
             Ka1 =   cosd(P(8,1))/( 1e-2*(norm(P(1,:)-P(2,:)) + norm(P(2,:)-P(3,:))) )^2;
             %KA1(i,j)=Ka1;
             Ka2 =   Ka1*cosd(P(9,1))/(1e-2*(norm(P(3,:)-P(4,:))))^2;
             %KA2(i,j)=Ka2;
             Ka3 =   Ka2*cosd(P(10,1))/(1e-2*(norm(P(4,:)-P(5,:))))^2;
             %KA3(i,j)=Ka3;
             Ka4 =   Ka3*cosd(P(11,1))^2/(1e-2*(norm(P(5,:)-P(6,:)) + norm(P(6,:)-P(7,:))))^2;
             %KA4(i,j)=Ka4;
             %KA5(i,j)=1./Ka4;
             %KA6(i,j)=1/Ka4;
          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));

    end
    t = toc;
   s = sprintf(&#39;Remaining time %2.3f hour&#39;,(t*length(Vb)-t*i)/3600) ;
end
close(hwb)
% Normalisation of Intesity matrix
%ICNNG=IC;
IC = IC./max(IC(:));
% Angles calculation
[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));

%PXX=PX(:,:,1)./PX(:,:,4);
%PXXG=squeeze(PXX);
%PXY=PX(:,:,2)./PX(:,:,4);
%PXYG=squeeze(PXY);
%PXZ=PX(:,:,3)./PX(:,:,4);
%PXZG=squeeze(PXZ);
%ICG=IC;
%THETAG=THETA;
%PHIG=PHI;
%RG=R;
%save(&#39;compG20.mat&#39;,&#39;ICG&#39;,&#39;THETAG&#39;,&#39;PHIG&#39;,&#39;RG&#39;,&#39;PXXG&#39;,&#39;PXYG&#39;,&#39;PXZG&#39;,&#39;ICNNG&#39;);%,&#39;KA1&#39;,&#39;KA2&#39;,&#39;KA3&#39;,&#39;KA4&#39;,&#39;KA5&#39;,&#39;KA6&#39;);
end
%f=figure;
%imtool(IC);
%THETA
%--------------------------------------------------------------------------

%=============== End of  My functions =================================


% --- Executes on button press in pbLoad.
function pbLoad_Callback(hObject, eventdata, handles)
% pbLoad_Callback - wczytuje film *.avi
%I:\!From Justice\0.1ml\Splited
[handles.f,handles.dir] = uigetfile( {&#39;*.avi&#39;;&#39;*.*&#39;},&#39;Load files&#39;,&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;,&#39;MultiSelect&#39;,&#39;on&#39; );
% wywietlamy na panelu nazwe filmu
    if ischar( handles.f )
        set( handles.up1, &#39;title&#39;, handles.f );
        handles.avi_title = handles.f;
        handles.fn = [handles.dir handles.f];
        inf = aviinfo(handles.fn);
        if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
        set(handles.slFrames,&#39;max&#39;,handles.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/handles.N_frames 10/handles.N_frames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,&#39;1&#39;)
    elseif iscell( handles.f )
        s = sprintf(&#39;%s in %3.1f parts&#39;,handles.f{1},size(handles.f,2) );
        set( handles.up1,&#39;title&#39;,s );

         handles.N_frames =0;
         for j = 1:length(handles.f)
             handles.fn = [handles.dir handles.f{j}];
             inf = aviinfo(handles.fn);
             handles.N_frames = handles.N_frames + inf.NumFrames; % total number of frames
         end
            handles.fn = [handles.dir handles.f{1}];
            inf = aviinfo(handles.fn);
            set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
            &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames],&#39;enable&#39;,&#39;on&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,1, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);
        set(handles.pmPart,&#39;string&#39;,num2str( (1:length(handles.f))&#39; ));
    elseif handles.f == 0
        set( handles.up1,&#39;title&#39;,&#39;No files...&#39; );
        set(handles.slFrames,&#39;enable&#39;,&#39;off&#39;);
        S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,0, 0);
        set(handles.upFrames,&#39;Title&#39;,S);
        return
    end
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.cF = Frame;
guidata(hObject,handles);
handles = Draw(hObject,handles);
% --- Executes on button press in chR.
function chR_Callback(hObject, eventdata, handles)
% hObject    handle to chR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chR



function edR_Callback(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edR as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edR as a double


% --- Executes during object creation, after setting all properties.
function edR_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chG.
function chG_Callback(hObject, eventdata, handles)
% hObject    handle to chG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chG



function edG_Callback(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edG as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edG as a double


% --- Executes during object creation, after setting all properties.
function edG_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chB.
function chB_Callback(hObject, eventdata, handles)
% hObject    handle to chB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chB



function edB_Callback(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edB as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edB as a double


% --- Executes during object creation, after setting all properties.
function edB_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chAdjust.
function chAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to chAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chAdjust



function edAdjust_Callback(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edAdjust as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAdjust as a double


% --- Executes during object creation, after setting all properties.
function edAdjust_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAdjust (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbSumFrames.
function pbSumFrames_Callback(hObject, eventdata, handles)
% this function calculates sum of frames
%
handles.nom = 1;
Frame = FrameRider(hObject,handles);
handles.sF = zeros( size( Frame ) );

count_step = str2double( get(handles.edSumFrameStep,&#39;string&#39;) );
wb = waitbar(0,&#39;Processing&#39;);
if iscell( handles.f )
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom
        waitbar(ii/Nom,wb,[&#39;Processing segment number &#39; num2str(ii) &#39; from &#39; num2str(Nom)]);
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        for j = 1:count_step:inf.NumFrames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
            handles.sF = handles.sF + Frame;
        end
    end
elseif ischar( handles.f )
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    for j = 1:count_step:inf.NumFrames-1
        waitbar(j/inf.NumFrames,wb,&#39;Processing...&#39;);        
        handles.nom = j;
        Frame = FrameRider(hObject,handles);
        handles.sF = handles.sF + Frame;
    end
end
close(wb);  
guidata( hObject, handles );
handles = Draw( hObject, handles );


function edSumFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edSumFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edSumFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edSumFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edSumFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in chSumFrames.
function chSumFrames_Callback(hObject, eventdata, handles)
% hObject    handle to chSumFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of chSumFrames


% --- Executes on button press in chSight.
function chSight_Callback(hObject, eventdata, handles)
% hObject    handle to chSight (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

handles = Draw(hObject,handles);
if get(hObject,&#39;value&#39;)~=1
      set(handles.hl(1),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(2),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(3),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(4),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(5),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(6),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(7),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(8),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
            set(handles.hl(9),&#39;xdata&#39;,[0,0],&#39;ydata&#39;,[0,0]);
end
    

% --- Executes on slider movement.
function slFrames_Callback(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    handles.nom  = round(get(handles.slFrames,&#39;value&#39;));
    set(handles.upFrames,&#39;title&#39;,num2str(handles.nom));
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    guidata(hObject, handles);
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
        set(handles.upFrames,&#39;Title&#39;,S);

% Hints: get(hObject,&#39;Value&#39;) returns position of slider
%        get(hObject,&#39;Min&#39;) and get(hObject,&#39;Max&#39;) to determine range of slider


% --- Executes during object creation, after setting all properties.
function slFrames_CreateFcn(hObject, eventdata, handles)
% hObject    handle to slFrames (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: slider controls usually have a light gray background.
if isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,[.9 .9 .9]);
end


% --- Executes on selection change in pmPart.
function pmPart_Callback(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    vel = get(handles.pmPart,&#39;value&#39;);
    handles.fn = [handles.dir handles.f{vel}];
    inf = aviinfo(handles.fn);
    set(handles.slFrames,&#39;max&#39;,inf.NumFrames,&#39;min&#39;,1,&#39;value&#39;,1,...
        &#39;sliderstep&#39;,[1/inf.NumFrames 10/inf.NumFrames]);
    handles.nom = 1;
    Frame = FrameRider(hObject,handles);
    handles.cF = Frame;
    handles = Draw(hObject,handles);
    S = sprintf(&#39;Current frame: %d; Total number of frame %d&#39;,handles.nom, handles.N_frames);
    set(handles.upFrames,&#39;Title&#39;,S);
    guidata(hObject,handles);
% Hints: contents = get(hObject,&#39;String&#39;) returns pmPart contents as cell array
%        contents{get(hObject,&#39;Value&#39;)} returns selected item from pmPart


% --- Executes during object creation, after setting all properties.
function pmPart_CreateFcn(hObject, eventdata, handles)
% hObject    handle to pmPart (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in rbR.
function rbR_Callback(hObject, eventdata, handles)
% hObject    handle to rbR (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbB,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbR


% --- Executes on button press in rbG.
function rbG_Callback(hObject, eventdata, handles)
% hObject    handle to rbG (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbB,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbG


% --- Executes on button press in rbB.
function rbB_Callback(hObject, eventdata, handles)
% hObject    handle to rbB (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.rbG,&#39;value&#39;,0);
set(handles.rbR,&#39;value&#39;,0);
handles = Draw(hObject,handles);
% Hint: get(hObject,&#39;Value&#39;) returns toggle state of rbB



function edPdrop_Callback(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edPdrop as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edPdrop as a double


% --- Executes during object creation, after setting all properties.
function edPdrop_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edPdrop (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edCCD_Callback(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edCCD as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edCCD as a double


% --- Executes during object creation, after setting all properties.
function edCCD_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edCCD (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edAperture_Callback(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
 handles = Draw(hObject,handles);

% Hints: get(hObject,&#39;String&#39;) returns contents of edAperture as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edAperture as a double


% --- Executes during object creation, after setting all properties.
function edAperture_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edAperture (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on mouse motion over figure - except title and menu.
function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)
% hObject    handle to Fig1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on mouse press over axes background.
function axes1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% get(hObject,&#39;CurrentPoint&#39;)


% --- Executes on button press in pbAngleCalc.
function pbAngleCalc_Callback(hObject, eventdata, handles)
% This function calculates correct angles distribution for the image with
% aberration.
%    handles = AnglesCalculator(handles);
%    guidata(hObject,handles);



% --- Executes on button press in pbIntensCalc.
function pbIntensCalc_Callback(hObject, eventdata, handles)
% hObject    handle to pbIntensCalc (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.NP = 700; % Number of angle points
step=single(64);
ipR=zeros(0,&#39;int32&#39;);
ipG=zeros(0,&#39;int32&#39;);
ipB=zeros(0,&#39;int32&#39;);
ICR_N=zeros(0,&#39;single&#39;);
ICG_N=zeros(0,&#39;single&#39;);
ICB_N=zeros(0,&#39;single&#39;);
I_S_R=zeros(0,&#39;int32&#39;);
I_S_G=zeros(0,&#39;int32&#39;);
I_S_B=zeros(0,&#39;int32&#39;);
ThetaR_S=zeros(1,&#39;single&#39;);
ThetaG_S=zeros(1,&#39;single&#39;);
ThetaB_S=zeros(1,&#39;single&#39;);
% Movie length estimation  
 count_step = str2double( get(handles.edFrameStep,&#39;string&#39;));
 handles.N_frames = 0;
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    for ii = 1 : Nom  % Number of moves parts
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
%    we should remember that quality of the last frame is not good     
        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);
    end
elseif ischar( handles.f ) % The single file is chosen
    path = [ handles.dir handles.f ];
    inf = aviinfo( path );
    handles.N_frames = length(1:count_step:inf.NumFrames-1);
    
end
% According to chosen checkbox:
 
if get(handles.chR,&#39;value&#39;)
    ipR = find(handles.BWR&#39;); % Searching for a good pixels related to the mask
    ThR=handles.THETA_R&#39;;
    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.
                                            % We have to add 90 degree or 270 according to beam direction.
    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    
    I_S_R=single(I_S_R);
    % Reduction of points    
    
    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;s step
    I_Red = single(zeros( handles.N_frames, handles.NP )); % Creation of empty matrix for intensity recording
    nThetaR = single(zeros( 1,handles.NP ));          % Angles vector
    icr=handles.ICR&#39;;
    ICR_N = icr(ipR);                 % Correction 
    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector
    
end
if get(handles.chG,&#39;value&#39;)
    ipG = find(handles.BWG&#39;);
    ThG=handles.THETA_G&#39;;
    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.
                                                   % We have to add 90 degree or 270 according to beam direction.
    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data
    I_S_G=single(I_S_G);
    % Reduction of points  
    
    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;s step
    I_Green = zeros(handles.N_frames,handles.NP);   % Creation of empty matrix for intensity recording
    
    nThetaG = zeros( 1,handles.NP ); 
    icg=handles.ICG&#39;;
    ICG_N = icg(ipG);
    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector
    
end
if get(handles.chB,&#39;value&#39;)
    ipB = find(handles.BWB&#39;);
    ThB=handles.THETA_B&#39;;
    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.
                                           % We have to add 90 degree or 270 according to beam direction.
    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data
    I_S_B=single(I_S_B);
    % Reduction of points
    
    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;s step
    I_Blue = zeros(handles.N_frames,handles.NP); % Creation of empty matrix for intensity recording  
    nThetaB = zeros( 1,handles.NP );
    icb=handles.ICB&#39;;
    ICB_N = icb( ipB );
    ICB_N = ICB_N./max( ICB_N(:) ); 
                                        
end
% 
% Preparing to read the data from the move file
% 
% Calculation of reduction coefficient:

wb_s = &#39;Time estimation...&#39;;
wb = waitbar( 0, wb_s );
if iscell( handles.f ) % In case of multi select function is enabled
    Nom = size( handles.f, 2 );
    count = 1;
  %% FIXME: could be sped up!!! with GPU  
  ite=0;
  %itb=1;
  ats=tic;
    for ii = 1 : Nom  % Number of moves parts
        waitbar(ii/Nom,wb,wb_s);
        tts=tic;
        path = [handles.dir handles.f{ii}];
        inf = aviinfo( path );
        
        if handles.GPU==1
        %handles.fn=handles.f{ii};
        handles.fn=path;
        itb=ite+1;
        ite=ite+inf.NumFrames;
     %I_RedM=zeros(700,inf.NumFrames,&#39;single&#39;);
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
    I_Red(itb:ite,:)=I_RedM&#39;;
    I_Green(itb:ite,:)=I_GreenM&#39;;
    I_Blue(itb:ite,:)=I_BlueM&#39;;
    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     tt=toc(tts)
        else
         
       for1 = tic;
        for j = 1:count_step:inf.NumFrames % Numbers of frames
            handles.nom = j;
            Frame = FrameRider(hObject,handles);
       %  The red channel is chosen
            if get(handles.chR,&#39;value&#39;)
                Red = Frame(:,:,1);
                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ir = MovingAverage(Ir, I_S_R, step);
                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                     
                      if max(ind)&gt;0
                          nThetaR(nom) = mean(ThetaR_S(ind));
                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                      else
                          nThetaR(nom) = nThetaR(nom-1);
                          I_Red(count,nom) = I_Red(count,nom-1);
                      end
                      nom = nom + 1;
                      
                  end
                  end
            end
            
        %  The green channel is chosen
            if get(handles.chG,&#39;value&#39;)
                Green = Frame(:,:,2);
                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ig = MovingAverage(Ig, I_S_G, step);
                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                      if max(ind)&gt;0
                          nThetaG(nom) = mean(ThetaG_S(ind));
                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                      else
                          nThetaG(nom) = nThetaG(nom-1);
                          I_Green(count,nom) = I_Green(count,nom-1);
                      end
                     
                      nom = nom + 1;
                  end
                  end
            end
            
        %  The blue channel is chosen
            if get(handles.chB,&#39;value&#39;)
                Blue = Frame(:,:,3);
                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
                  if handles.GPU==1
                    Ib = MovingAverage(Ib, I_S_B,step);
                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
                  else
                  nom = 1;
                % Reduction of number of points
                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                      if max(ind)&gt;0
                          nThetaB(nom) = mean(ThetaB_S(ind));
                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                      else
                          nThetaB(nom) = nThetaB(nom-1);
                          I_Blue(count,nom) = I_Blue(count,nom-1);
                      end
                      nom = nom + 1;
                  end
                  end
            end
             count = count+1;
        end
        tt = toc(for1);
        end
       
        wb_s = sprintf(&#39;Processing segment number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
                       ii,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));
    end
    toc(ats)
     
elseif ischar( handles.f ) % The single file is chosen
     path  = [ handles.dir handles.f ];
     
     if handles.GPU==1
     tic;
     if inf.NumFrames &lt;= inf.FileSize/(640*480*2+8)
            handles.N_frames = inf.NumFrames; % total number of frames
        else
            handles.N_frames = double(int32((inf.FileSize-64564)/(640*480*2+8))-2);
        end
%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));
I_Red=I_RedM&#39;;
    I_Green=I_GreenM&#39;;
    I_Blue=I_BlueM&#39;;     
toc
     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));
     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));
     else

     count = 1;
     for j = 1:count_step:inf.NumFrames-1
         waitbar(j/inf.NumFrames,wb,wb_s);
         tic;
         handles.nom = j;
         Frame = FrameRider(hObject,handles);
         %  The red channel is chosen
         if get(handles.chR,&#39;value&#39;)
             Red = Frame(:,:,1)&#39;;
             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector
             
             if handles.GPU==1
                 Ir = MovingAverage(Ir, I_S_R, step);
                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));
                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));
                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));
             else
             
             nom = 1;
             % Reduction of number of points
             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)
                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );
                 if max(ind)&gt;0
                     nThetaR(nom) = mean(ThetaR_S(ind));
                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );
                 else
                     nThetaR(nom) = nThetaR(nom-1);
                     I_Red(count,nom) = I_Red(count,nom-1);
                 end
                 nom = nom + 1;
             end
             
             end
         end
         
         %  The green channel is chosen
         if get(handles.chG,&#39;value&#39;)
             Green = Frame(:,:,2);
             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ig = MovingAverage(Ig, I_S_G, step);
                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)
                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );
                 if max(ind)&gt;0
                     nThetaG(nom) = mean(ThetaG_S(ind));
                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );
                 else
                     nThetaG(nom) = nThetaG(nom-1);
                     I_Green(count,nom) = I_Green(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         
         %  The blue channel is chosen
         if get(handles.chB,&#39;value&#39;)
             Blue = Frame(:,:,3);
             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector
             if handles.GPU==1
                 Ib = MovingAverage(Ib, I_S_B,step);
                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));
             else
             nom = 1;
             % Reduction of number of points
             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)
                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );
                 if max(ind)&gt;0
                     nThetaB(nom) = mean(ThetaB_S(ind));
                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );
                 else
                     nThetaB(nom) = nThetaB(nom-1);
                     I_Blue(count,nom) = I_Blue(count,nom-1);
                 end
                 nom = nom + 1;
             end
             end
         end
         tt = toc;
         wb_s = sprintf(&#39;Processing frame number %1.0f from %1.0f \n Remaining time: %s .&#39;,...
             j,inf.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((inf.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));
         
             count = count + 1;
     end
     end
     
end


     if get(handles.chR,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);
         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);
     end
     if get(handles.chG,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);
         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);
     end
     if get(handles.chB,&#39;value&#39;)
         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);
         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);
     end
     close(wb);
   guidata(hObject,handles);


function edLineSh_Callback(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of edLineSh as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edLineSh as a double


% --- Executes during object creation, after setting all properties.
function edLineSh_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edLineSh (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbLoadParam.
function pbLoadParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbLoadParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    Save = evalin(&#39;base&#39;,&#39;Save&#39;);
% loading checkbox structure
    set(handles.chR,&#39;value&#39;,Save.chR_value);
    set(handles.chG,&#39;value&#39;,Save.chG_value);
    set(handles.chB,&#39;value&#39;,Save.chB_value);  
  %---
    set(handles.chSight,&#39;value&#39;,Save.chSight);
    set(handles.chAdjust,&#39;value&#39;,Save.chAdjust);
% Loading lambda edit boxes
    set(handles.edR,&#39;string&#39;,Save.edR);
    set(handles.edG,&#39;string&#39;,Save.edG);
    set(handles.edB,&#39;string&#39;,Save.edB);
% Loading position paramiters
    set(handles.edPdrop,&#39;string&#39;,Save.Pk);
    set(handles.edCCD,&#39;string&#39;,Save.edCCD);
    set(handles.edAperture,&#39;string&#39;,Save.edAperture);
    set(handles.edLineSh,&#39;string&#39;,Save.shLW);
    set(handles.ed_Sh_l1,&#39;string&#39;,Save.ed_Sh_l1);
% Loading frame step and Adjust box    
    set(handles.edAdjust,&#39;string&#39;,Save.edAdjust);
    set(handles.edSumFrameStep,&#39;string&#39;,Save.edSumFrameStep);
    set(handles.edFrameStep,&#39;string&#39;,Save.edFrameStep);
% Loading ThetaPhiR structure
    % Saving angles and masks
%      --  masks --
    handles.BWR = Save.BWR;
    handles.BWG = Save.BWG;
    handles.BWB = Save.BWB;
%      --  border of masks --
    handles.R_position = Save.R_position;
    handles.G_position = Save.G_position;
    handles.B_position = Save.B_position;
% Correction masks
    handles.ICR = Save.ICR;
    handles.ICG = Save.ICG;
    handles.ICB = Save.ICB;
% Angles matrix    
    handles.THETA_R = Save.THETA_R;
    handles.THETA_G = Save.THETA_G;
    handles.THETA_B = Save.THETA_B;
%      ---    
    handles.PHI_R   = Save.PHI_R;
    handles.PHI_G   = Save.PHI_G;
    handles.PHI_B   = Save.PHI_B;
    handles = Draw(hObject,handles);


% --- Executes on button press in pbSaveParam.
function pbSaveParam_Callback(hObject, eventdata, handles)
% hObject    handle to pbSaveParam (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
% Saving checkbox structure
    Save.chR_value = get(handles.chR,&#39;value&#39;);
    Save.chG_value = get(handles.chG,&#39;value&#39;);
    Save.chB_value = get(handles.chB,&#39;value&#39;);
%---
    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);
    Save.chSight   = get(handles.chSight,&#39;value&#39;);
% Saving lambda edit boxes
    Save.edR = get(handles.edR,&#39;string&#39;);
    Save.edG = get(handles.edG,&#39;string&#39;);
    Save.edB = get(handles.edB,&#39;string&#39;);
% Saving position paramiters
    Save.Pk    = get(handles.edPdrop,&#39;string&#39;);
    Save.edCCD = get(handles.edCCD,&#39;string&#39;);
    Save.edAperture = get(handles.edAperture,&#39;string&#39;);
    Save.shLW     = get(handles.edLineSh,&#39;string&#39;);
    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;string&#39;); % distance between lenses
% Saving Frame step and Adjust box
    Save.edAdjust = get(handles.edAdjust,&#39;string&#39;);
    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;string&#39;);
    Save.edFrameStep = get(handles.edFrameStep,&#39;string&#39;);
% Saving angles and masks
%      --  masks --
    Save.BWR = handles.BWR;
    Save.BWG = handles.BWG;
    Save.BWB = handles.BWB;
%      --  border of masks --
    Save.R_position = handles.R_position;
    Save.G_position = handles.G_position;
    Save.B_position = handles.B_position;
% Correction masks
    Save.ICR = handles.ICR;
    Save.ICG = handles.ICG;
    Save.ICB = handles.ICB;
% Angles matrix    
    Save.THETA_R = handles.THETA_R;
    Save.THETA_G = handles.THETA_G;
    Save.THETA_B = handles.THETA_B;
%      ---    
    Save.PHI_R   = handles.PHI_R;
    Save.PHI_G   = handles.PHI_G;
    Save.PHI_B   = handles.PHI_B;
    handles.dir;
    savePath = [ handles.dir &#39;SaveParams.mat&#39;];
    if exist(savePath)
    % File exist!
       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);
       switch button
           case &#39;Rewrite&#39;
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           case &#39;NO&#39;
             [file,path] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  
             if file == 0
                 return;
             end;
               savePath =[path,file];
               save(savePath,&#39;Save&#39;);
               sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
           otherwise
           
       end
    else
    % File dose not exist.
        save(savePath,&#39;Save&#39;);
        sprintf(&#39;Parameters has been saved to the directory:\n %s&#39;,savePath)
    end
    assignin(&#39;base&#39;,&#39;Save&#39;,Save);

function ed_Sh_l1_Callback(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles = Draw(hObject,handles);
% Hints: get(hObject,&#39;String&#39;) returns contents of ed_Sh_l1 as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of ed_Sh_l1 as a double


% --- Executes during object creation, after setting all properties.
function ed_Sh_l1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ed_Sh_l1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbNA_Aprox.
function pbNA_Aprox_Callback(hObject, eventdata, handles)
% hObject    handle to pbNA_Aprox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
Bw2 = roipoly(handles.cF(:,:,1),handles.R1(1,:)+ handles.TshX + handles.shX,handles.R1(2,:)+ handles.TshY + handles.shY);
Ap = sum(sum(Bw2,2)~=0);  % The aperture (diameter) size in [pix]
Apm = Ap*handles.S.PixSize; % The aperture (diameter) size in [mm]
Phi = atan(handles.S.dH/2/handles.S.R_dis_Ring);
LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element
% compound of masks   
id = find(sum(handles.Bw,1)); % id - non-zero pixels
NA_Theta = atan((id-320+ handles.TshX + handles.shX)*handles.S.PixSize/LCCD);
I = zeros( handles.N_frames, length(NA_Theta) );
nom = 1;
 wb = waitbar(0,&#39;Angle Calculation&#39;);
 t=0;
for i = 1 : length( handles.f ) % cycle by pieces of movie
    handles.fn = [handles.dir handles.f{i}];
    inf = aviinfo(handles.fn);
    for j = 1 : inf.NumFrames
        s = sprintf(&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;,...
                     j,handles.N_frames*t/60,(handles.N_frames-nom)*t/60);
        waitbar(i/length( handles.f ),wb,s);
        %  Choosing the channel
        handles.nom = j;
        handles.cF = FrameRider(hObject,handles);
        if get(handles.rbR,&#39;value&#39;)
            Frame = handles.cF(:,:,1);
        end
        if get(handles.rbG,&#39;value&#39;)
            Frame = handles.cF(:,:,2);
        end
        if get(handles.rbB,&#39;value&#39;)
            Frame = handles.cF(:,:,3);
        end
       tic; 
     Temp =  mean(Frame.*handles.Bw,1);
      I(nom,:) =Temp(id);
      t = toc;
      nom = nom + 1;
    end
end
close(wb);
assignin(&#39;base&#39;,&#39;I_NA&#39;,I);
assignin(&#39;base&#39;,&#39;Theta_NA&#39;,NA_Theta)


% --------------------------------------------------------------------
function muCI_Callback(hObject, eventdata, handles)
% hObject    handle to muCI (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muCalcIm_Callback(hObject, eventdata, handles)
% The function muCalcIm_Callback calculates the intensity matrix and angles
% matrix
    if get(handles.chR,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edR,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(hObject,handles);
        %size(handles.THETA_R)
    end
    if get(handles.chG,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edG,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICG,handles.THETA_G,handles.PHI_G] =  IC_Calculation(hObject,handles);
    end
    if get(handles.chB,&#39;value&#39;)
        handles.S.lambda = str2double(get(handles.edB,&#39;string&#39;));
        handles.S.m2 = Calculate_m(25,handles.S.lambda, &#39;BK7&#39;);
        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);
    end
guidata(hObject,handles);


function edFrStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrStep as a double


% --- Executes during object creation, after setting all properties.
function edFrStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end



function edFrameStep_Callback(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,&#39;String&#39;) returns contents of edFrameStep as text
%        str2double(get(hObject,&#39;String&#39;)) returns contents of edFrameStep as a double


% --- Executes during object creation, after setting all properties.
function edFrameStep_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edFrameStep (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))
    set(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);
end


% --- Executes on button press in pbEditMask.
function pbEditMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbEditMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.R_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3) );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

% --- Executes on button press in pbSetMask.

 function pbSetMask_Callback(hObject, eventdata, handles)
% hObject    handle to pbSetMask (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Setting the mask 
if get(handles.chR,&#39;value&#39;) % mask for red channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,1),[0 max(max(handles.cF(:,:,1)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...
        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWR = Bw1.*Bw2;
    handles.R_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
if get(handles.chG,&#39;value&#39;) % mask for green channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,2),[0 max(max(handles.cF(:,:,2)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...
        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWG = Bw1.*Bw2;
    handles.G_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end

if get(handles.chB,&#39;value&#39;) % mask for blue channel
    % Prepearing image
    hf = imtool( handles.cF(:,:,3),[0 max(max(handles.cF(:,:,3)))/3] );
    set(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)
    ha = get(hf,&#39;CurrentAxes&#39;);
    hold(ha,&#39;on&#39;);
    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...
        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);
    % Start to drawing matrix
    h = impoly(ha); % Create draggable, resizable polygon
    position = wait(h);
    delete(hf);
    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);
    % mask from aperture
    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));
    % compound of masks  for red channel
    handles.BWB = Bw1.*Bw2;
    handles.B_position = position; % coord handles for mascksinates of mask
    guidata(hObject,handles);
end
   
   



% --------------------------------------------------------------------
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muIntCon_Callback(hObject, eventdata, handles)
% hObject    handle to muIntCon (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
    if get(handles.chR,&#39;value&#39;)
        Frame = handles.cF(:,:,1);
        s=&#39;Red Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chG,&#39;value&#39;)
        Frame = handles.cF(:,:,2);
        s=&#39;Green Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    if get(handles.chB,&#39;value&#39;)
        Frame = handles.cF(:,:,3);
        s=&#39;Blue Frame&#39;;
         hf = imtool(Frame);
    title(s);
    figure;
    mesh(Frame);
    title(s);
    end
    
% --------------------------------------------------------------------
function muCros_Callback(hObject, eventdata, handles)
% hObject    handle to muCros (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function muFitModel_Callback(hObject, eventdata, handles)
% hObject    handle to muFitModel (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
handles.S.N = 2e2;
Br = BorderCreation(hObject,handles);
% figure;
% get only the part of border points 
Vb = (1 + handles.S.N ) : handles.S.N * 2;
IM = zeros(480,640);
Dw = linspace(-handles.S.dW/2,handles.S.dW/2,handles.S.N);
Dh = linspace(-handles.S.dH/2,handles.S.dH/2,handles.S.N);
VH = linspace(handles.S.dH/2,-handles.S.dH/2,handles.S.N);
% 
% I0 = sind(linspace(0,4*360,5500)).^2;
hwb = waitbar(0,&#39;Computation of intensity matrix ...&#39;);

InSurph = zeros(length(VH), length(Vb),3);
OutSurph = InSurph;

for i = 1 : length(VH)    % The movement across Z axis
    waitbar(i/length(Dw),hwb)
    for j = 1 : length(Vb) % The movement across curved border
        Pd = [ Br(Vb(j),1), Br(Vb(j),2), VH(i) ]; % toczka na kraju diafragmy
        P = RayTracing(Pd,handles.S);
         if size(P,1) == 7
            InSurph(i,j,:) = Pd;
            OutSurph(i,j,:) = P(7,:);
         end
    end
end

close(hwb)


% --- Executes on button press in checkbox6.
function checkbox6_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,&#39;Value&#39;) returns toggle state of checkbox6
handles.GPU=get(hObject,&#39;Value&#39;);
guidata(hObject,handles);
</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    %poza <a class="code" href="_pike_reader_8m.html#a4e41918df3b734cb20355ce9ca8ab336">macierz</a></div>
<div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a4e41918df3b734cb20355ce9ca8ab336">  383</a></span>&#160;    [IC,<a class="code" href="_pike_reader_8m.html#a4624ad09721d379eb37b97070c9259c4">PX</a>]=RayTracingCUDA(<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(<a class="code" href="_pike_reader_8m.html#afc718730e782c562dbdd8cbdda84fb46">Vb</a>(1,:),1), <a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(Vb(1,:),2), <a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(:,3),handles);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a></div>
<div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">  385</a></span>&#160;    %[IC,<a class="code" href="_pike_reader_8m.html#a4624ad09721d379eb37b97070c9259c4">PX</a>]=RayTracingCUDA(Br(Vb(1,100:110),1), Br(Vb(1,100:110),2),Br(100:110,3),handles);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(IC);</div>
<div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ab7d639bee69ea566d05c15438d20ceaf">  387</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#ab7d639bee69ea566d05c15438d20ceaf">ICNNT</a>=IC;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    IC = IC./<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(IC(:));</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(IC);</div>
<div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">  392</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="_pike_reader_8m.html#a627e20db9e96bdd9b52fb1f131fb5cd4">mesh</a>(<span class="keywordtype">double</span>(IC));</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    </div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#abdb0d19a8959793169aa443f82d9fdb3">  395</a></span>&#160;    %<a class="code" href="_pike_reader_8m.html#abdb0d19a8959793169aa443f82d9fdb3">PXX</a>=<a class="code" href="_pike_reader_8m.html#a4624ad09721d379eb37b97070c9259c4">PX</a>(1,1:10,1:10)./PX(4,1:10,1:10)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="_pike_reader_8m.html#abdb0d19a8959793169aa443f82d9fdb3">PXX</a>=PX(1,:,:)./PX(4,:,:);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="_pike_reader_8m.html#abdb0d19a8959793169aa443f82d9fdb3">PXX</a>=squeeze(<a class="code" href="_pike_reader_8m.html#abdb0d19a8959793169aa443f82d9fdb3">PXX</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a>(PXX)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(PXX);</div>
<div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a08dc1a08a766f17149e25935eb560cde">  400</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a08dc1a08a766f17149e25935eb560cde">PXY</a>=PX(2,:,:)./PX(4,:,:);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="_pike_reader_8m.html#a08dc1a08a766f17149e25935eb560cde">PXY</a>=squeeze(<a class="code" href="_pike_reader_8m.html#a08dc1a08a766f17149e25935eb560cde">PXY</a>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(PXY);</div>
<div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad17d63e56d09c69bd3c90b4d0296f93d">  403</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#ad17d63e56d09c69bd3c90b4d0296f93d">PXZ</a>=PX(3,:,:)./PX(4,:,:);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="_pike_reader_8m.html#ad17d63e56d09c69bd3c90b4d0296f93d">PXZ</a>=squeeze(<a class="code" href="_pike_reader_8m.html#ad17d63e56d09c69bd3c90b4d0296f93d">PXZ</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(PXZ);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    %[THETA,<a class="code" href="_pike_reader_8m.html#aa9c19988f200a79e3fa5bf1f1dd3d816">PHI</a>,<a class="code" href="demosaic__mw_8m.html#acb95449a94688af33f6e9bb090cf2936">R</a>] = cart2sph(PX(1,:,:)./PX(4,:,:),PX(2,:,:)./PX(4,:,:),PX(3,:,:)./PX(4,:,:));</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    [THETA,<a class="code" href="_pike_reader_8m.html#aa9c19988f200a79e3fa5bf1f1dd3d816">PHI</a>,<a class="code" href="demosaic__mw_8m.html#acb95449a94688af33f6e9bb090cf2936">R</a>] = cart2sph(PXX,PXY,PXZ);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(THETA);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(<a class="code" href="_pike_reader_8m.html#aa9c19988f200a79e3fa5bf1f1dd3d816">PHI</a>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(<a class="code" href="demosaic__mw_8m.html#acb95449a94688af33f6e9bb090cf2936">R</a>);</div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#af94b494535f1086dd38596a1744365b5">  412</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#af94b494535f1086dd38596a1744365b5">ICT</a>=IC;</div>
<div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#acc5fdf94db2193839902773727d92486">  413</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#acc5fdf94db2193839902773727d92486">THETAT</a>=THETA;</div>
<div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a24d4e446a6c7ef27023343f01fd3fc80">  414</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a24d4e446a6c7ef27023343f01fd3fc80">PHIT</a>=PHI;</div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#af5dee50ba772d5ac68d4ef025c90b653">  415</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#af5dee50ba772d5ac68d4ef025c90b653">RT</a>=R;</div>
<div class="line"><a name="l00416"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a8219f7d88c4c815a7225a11f8fc48597">  416</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a8219f7d88c4c815a7225a11f8fc48597">PXXT</a>=PXX;</div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a2c21aa3b460e6fdf20b31a7a9cb73686">  417</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a2c21aa3b460e6fdf20b31a7a9cb73686">PXYT</a>=PXY;</div>
<div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a597c256ab63e46a3b384d171dc07e24c">  418</a></span>&#160;    <a class="code" href="_pike_reader_8m.html#a597c256ab63e46a3b384d171dc07e24c">PXZT</a>=PXZ;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    %<a class="code" href="_pike_reader_8m.html#a7de0a9938c22cb89998f4b33689f73a5">save</a>(&#39;compT.mat&#39;,&#39;<a class="code" href="_pike_reader_8m.html#af94b494535f1086dd38596a1744365b5">ICT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#acc5fdf94db2193839902773727d92486">THETAT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a24d4e446a6c7ef27023343f01fd3fc80">PHIT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#af5dee50ba772d5ac68d4ef025c90b653">RT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a8219f7d88c4c815a7225a11f8fc48597">PXXT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a2c21aa3b460e6fdf20b31a7a9cb73686">PXYT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a597c256ab63e46a3b384d171dc07e24c">PXZT</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#ab7d639bee69ea566d05c15438d20ceaf">ICNNT</a>&#39;);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;else</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;handles.S.N = 3e3; % Number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points per side</div>
<div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">  422</a></span>&#160;Br = single(<a class="code" href="_pike_reader_8m.html#aaa03ee2d9c5e52d9a5afa7b300071b6f">BorderCreation</a>(hObject,handles));</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;% <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a> only the part <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> border points </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;Vb = (1 + handles.S.N ) : handles.S.N * 2; % Indexes for bottom electrode</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;IC = single(zeros(480,640));   % Declaration <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> correction <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;PX = single(zeros(480,640,4)); % Declaration <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> pixel position <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                       % PX(<a class="code" href="_ray_tracing_8m.html#aee34fc740f3a5271508e6499ce2e3326">X</a>,Y,Nom); Where Nom is a number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> rays that</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                       % walk into cell</div>
<div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">  430</a></span>&#160;<a class="code" href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">hwb</a> = waitbar(0,&#39;Computation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> intensity <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> ...&#39;);</div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">  431</a></span>&#160;<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> = &#39;Time estimation...&#39;;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;for i = 1 : length(Vb)    % The movment across <a class="code" href="_pike_reader_8m.html#a2e13bf91d03a85943c3365be0dc8173a">Z</a> axis</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    waitbar(i/length(Vb),<a class="code" href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">hwb</a>,<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="_pike_reader_8m.html#a8fb092330ecda60587643305d0d9738a">tic</a>;</div>
<div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">  435</a></span>&#160;    for <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 1 : length(Vb) % The movement across curved border</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        Pd = [ Br(Vb(<a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>),1), Br(Vb(j),2), Br(i,3) ]; % toczka na kraju diafragmy</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        P = RayTracing(Pd,handles.S);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;              % shifting <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask position according experimental data</div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aabc621035b24273abc351729676cf921">  439</a></span>&#160;                 <a class="code" href="_pike_reader_8m.html#aabc621035b24273abc351729676cf921">W</a>  =  handles.shX + ( handles.S.<a class="code" href="_pike_reader_8m.html#a9349b39d3b86ed6b44272d93479cb559">CCDW</a>/2 +P(7,2))/handles.S.PixSize; </div>
<div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a7e55b80aae57454b1b0353641cb67b33">  440</a></span>&#160;                 <a class="code" href="_pike_reader_8m.html#a7e55b80aae57454b1b0353641cb67b33">Hi</a> =  handles.shY + (handles.S.<a class="code" href="_pike_reader_8m.html#a8ed6ac5cbd6e13e4eadfda44f8d995b8">CCDH</a>/2 +P(7,3))/handles.S.PixSize;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;               % Recording position <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> rays and a number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> rays that</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;               % walk into the cell</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;               </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                 PX(round(<a class="code" href="_pike_reader_8m.html#a7e55b80aae57454b1b0353641cb67b33">Hi</a>),round(<a class="code" href="_pike_reader_8m.html#aabc621035b24273abc351729676cf921">W</a>),1) = PX(round(Hi),round(W),1) + P(2,1);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                 PX(round(Hi),round(W),2) = PX(round(Hi),round(W),2) + P(2,2);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                 PX(round(Hi),round(W),3) = PX(round(Hi),round(W),3) + P(2,3);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                 PX(round(Hi),round(W),4) = PX(round(Hi),round(W),4) + 1;</div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad79aa7d5e6e37e487edfcc745e3f3c88">  448</a></span>&#160;         % The <a class="code" href="_pike_reader_8m.html#a33cb10e751a17a81c39b07c9dc1710ae">calculation</a> <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> energy <a class="code" href="_pike_reader_8m.html#ad79aa7d5e6e37e487edfcc745e3f3c88">loss</a>,  caused by reflection on lens surfaces</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;         % and rising distance</div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad7d8756ffc9df06bb6bb864280ffc5d3">  450</a></span>&#160;             <a class="code" href="_pike_reader_8m.html#ad7d8756ffc9df06bb6bb864280ffc5d3">Ka1</a> =   <a class="code" href="_ray_tracing_8m.html#a415c5c5d1f49ee2db2762c80067a9bdc">cosd</a>(P(8,1))/( 1<a class="code" href="_calculate__m_8m.html#a08a4415e9d594ff960030b921d42b91e">e</a>-2*(<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(P(1,:)-P(2,:)) + <a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(P(2,:)-P(3,:))) )^2;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;             %<a class="code" href="_pike_reader_8m.html#a7ab10073dde4b253ad2f8fead0e352b8">KA1</a>(i,j)=<a class="code" href="_pike_reader_8m.html#ad7d8756ffc9df06bb6bb864280ffc5d3">Ka1</a>;</div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a580628da7b9cb7e817437cacb89c8300">  452</a></span>&#160;             <a class="code" href="_pike_reader_8m.html#a580628da7b9cb7e817437cacb89c8300">Ka2</a> =   Ka1*<a class="code" href="_ray_tracing_8m.html#a415c5c5d1f49ee2db2762c80067a9bdc">cosd</a>(P(9,1))/(1<a class="code" href="_calculate__m_8m.html#a08a4415e9d594ff960030b921d42b91e">e</a>-2*(<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(P(3,:)-P(4,:))))^2;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;             %<a class="code" href="_pike_reader_8m.html#a3b1f2de14b8a6c0b78d815e608e45a8a">KA2</a>(i,j)=<a class="code" href="_pike_reader_8m.html#a580628da7b9cb7e817437cacb89c8300">Ka2</a>;</div>
<div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a3cb4559b90e7cbf954590f076bdbed81">  454</a></span>&#160;             <a class="code" href="_pike_reader_8m.html#a3cb4559b90e7cbf954590f076bdbed81">Ka3</a> =   Ka2*<a class="code" href="_ray_tracing_8m.html#a415c5c5d1f49ee2db2762c80067a9bdc">cosd</a>(P(10,1))/(1<a class="code" href="_calculate__m_8m.html#a08a4415e9d594ff960030b921d42b91e">e</a>-2*(<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(P(4,:)-P(5,:))))^2;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;             %<a class="code" href="_pike_reader_8m.html#aa656899df1f8926fc8507851b84bf381">KA3</a>(i,j)=<a class="code" href="_pike_reader_8m.html#a3cb4559b90e7cbf954590f076bdbed81">Ka3</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad30dfa987bf399e9d5c8256815544151">  456</a></span>&#160;             <a class="code" href="_pike_reader_8m.html#ad30dfa987bf399e9d5c8256815544151">Ka4</a> =   Ka3*<a class="code" href="_ray_tracing_8m.html#a415c5c5d1f49ee2db2762c80067a9bdc">cosd</a>(P(11,1))^2/(1<a class="code" href="_calculate__m_8m.html#a08a4415e9d594ff960030b921d42b91e">e</a>-2*(<a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(P(5,:)-P(6,:)) + <a class="code" href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a>(P(6,:)-P(7,:))))^2;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;             %<a class="code" href="_pike_reader_8m.html#ac4ca50a39233ee7f03b0e8ec074a7be0">KA4</a>(i,j)=<a class="code" href="_pike_reader_8m.html#ad30dfa987bf399e9d5c8256815544151">Ka4</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;             %<a class="code" href="_pike_reader_8m.html#a38085a9efe80800b5ff4a73688322798">KA5</a>(i,j)=1./Ka4;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;             %<a class="code" href="_pike_reader_8m.html#a29ecbdb426abecbcedbd450486d5ded2">KA6</a>(i,j)=1/Ka4;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          IC(round(Hi),round(W)) = 1./Ka4 + IC(round(Hi),round(W));</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    end</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a> = <a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   s = sprintf(&#39;Remaining time %2.3<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a> hour&#39;,(<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a>*length(Vb)-<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a>*i)/3600) ;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;end</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<a class="code" href="_pike_reader_8m.html#a1e9b0febbb137ecc9c2e2a5c34f66184">close</a>(hwb)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;% Normalisation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> Intesity matrix</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;%ICNNG=IC;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;IC = IC./<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(IC(:));</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;% Angles <a class="code" href="_pike_reader_8m.html#a33cb10e751a17a81c39b07c9dc1710ae">calculation</a></div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a33cb10e751a17a81c39b07c9dc1710ae">  471</a></span>&#160;[THETA,PHI,R] = cart2sph(PX(:,:,1)./PX(:,:,4),PX(:,:,2)./PX(:,:,4),PX(:,:,3)./PX(:,:,4));</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;%PXX=PX(:,:,1)./PX(:,:,4);</div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a9a1bbf30810d9fbcda4b4d7806f3d145">  474</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a9a1bbf30810d9fbcda4b4d7806f3d145">PXXG</a>=squeeze(PXX);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;%PXY=PX(:,:,2)./PX(:,:,4);</div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a241bee448f7831627b9de6c106d81b05">  476</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a241bee448f7831627b9de6c106d81b05">PXYG</a>=squeeze(PXY);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;%PXZ=PX(:,:,3)./PX(:,:,4);</div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aa329f5d1d9f4a435327c228671eb52f7">  478</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#aa329f5d1d9f4a435327c228671eb52f7">PXZG</a>=squeeze(PXZ);</div>
<div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">  479</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">ICG</a>=IC;</div>
<div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a8819ca81ee58682f9892c4891a536615">  480</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a8819ca81ee58682f9892c4891a536615">THETAG</a>=THETA;</div>
<div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aec57c8145e51accce560df6ba86c5795">  481</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#aec57c8145e51accce560df6ba86c5795">PHIG</a>=PHI;</div>
<div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a66b9fe71b5a03cdf31bf5b618afcd369">  482</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a66b9fe71b5a03cdf31bf5b618afcd369">RG</a>=R;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;%<a class="code" href="_pike_reader_8m.html#a7de0a9938c22cb89998f4b33689f73a5">save</a>(&#39;compG20.mat&#39;,&#39;<a class="code" href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">ICG</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a8819ca81ee58682f9892c4891a536615">THETAG</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#aec57c8145e51accce560df6ba86c5795">PHIG</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a66b9fe71b5a03cdf31bf5b618afcd369">RG</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a9a1bbf30810d9fbcda4b4d7806f3d145">PXXG</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a241bee448f7831627b9de6c106d81b05">PXYG</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#aa329f5d1d9f4a435327c228671eb52f7">PXZG</a>&#39;,&#39;ICNNG&#39;);%,&#39;<a class="code" href="_pike_reader_8m.html#a7ab10073dde4b253ad2f8fead0e352b8">KA1</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a3b1f2de14b8a6c0b78d815e608e45a8a">KA2</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#aa656899df1f8926fc8507851b84bf381">KA3</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#ac4ca50a39233ee7f03b0e8ec074a7be0">KA4</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a38085a9efe80800b5ff4a73688322798">KA5</a>&#39;,&#39;<a class="code" href="_pike_reader_8m.html#a29ecbdb426abecbcedbd450486d5ded2">KA6</a>&#39;);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;end</div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">  485</a></span>&#160;%<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a>=<a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;%<a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(IC);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;%THETA</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;%--------------------------------------------------------------------------</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;%=============== End <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a>  My functions =================================</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;% --- Executes on button press in pbLoad.</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;function pbLoad_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;% pbLoad_Callback - wczytuje film *.avi</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;%<a class="code" href="demosaic__c__mex_8c.html#a60ef6e1bcfabb95cfeb300e1d03ce470">I</a>:\!From Justice\0.1ml\Splited</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;[handles.<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a>,handles.dir] = uigetfile( {<span class="stringliteral">&#39;*.avi&#39;</span>;<span class="stringliteral">&#39;*.*&#39;</span>},<span class="stringliteral">&#39;Load files&#39;</span>,<span class="stringliteral">&#39;D:\!Work\!Projects\Aberration correction\AVI&#39;</span>,<span class="stringliteral">&#39;MultiSelect&#39;</span>,<span class="stringliteral">&#39;on&#39;</span> );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;% wywietlamy na panelu nazwe filmu</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> <a class="code" href="_pike_reader_8m.html#aae1d1bec0e9c36c2fddc5cd87d8c4eee">ischar</a>( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f )</div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">  500</a></span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.up1, &#39;<a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>&#39;, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a> );</div>
<div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#ad890cb44dd0cf10657a62ee68206c497">  501</a></span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad890cb44dd0cf10657a62ee68206c497">avi_title</a> = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a53323a4c01bdc9e45b28410b296cb054">fn</a> = [<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.dir <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f];</div>
<div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">  503</a></span>&#160;        <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a> = aviinfo(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a53323a4c01bdc9e45b28410b296cb054">fn</a>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames &lt;= <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.FileSize/(640*480*2+8)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames = <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames; % total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> frames</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        else</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames = <span class="keywordtype">double</span>(int32((<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.FileSize-64564)/(640*480*2+8))-2);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        end</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.slFrames,&#39;<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames,&#39;min&#39;,1,&#39;value&#39;,1,...</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            &#39;sliderstep&#39;,[1/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames 10/<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames],&#39;enable&#39;,&#39;on&#39;);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a> = sprintf(&#39;Current <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a>: %d; Total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> %d&#39;,1, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.upFrames,&#39;Title&#39;,<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.pmPart,&#39;<span class="keywordtype">string</span>&#39;,&#39;1&#39;)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="nvmex__helper_8m.html#a52e3417805be73af234040a44925af06">elseif</a> iscell( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f )</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> = sprintf(&#39;%<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> in %3.1f parts&#39;,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f{1},<a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f,2) );</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.up1,<span class="stringliteral">&#39;title&#39;</span>,<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> );</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;         <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames =0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;         <span class="keywordflow">for</span> <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 1:length(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;             <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a53323a4c01bdc9e45b28410b296cb054">fn</a> = [<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.dir <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a>{<a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>}];</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;             <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a> = aviinfo(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;             <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames + <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames; % total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> frames</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;         end</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn = [handles.dir handles.f{1}];</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a> = aviinfo(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.slFrames,<span class="stringliteral">&#39;max&#39;</span>,<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames,<span class="stringliteral">&#39;min&#39;</span>,1,<span class="stringliteral">&#39;value&#39;</span>,1,...</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="stringliteral">&#39;sliderstep&#39;</span>,[1/<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames 10/<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames],<span class="stringliteral">&#39;enable&#39;</span>,<span class="stringliteral">&#39;on&#39;</span>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a> = sprintf(<span class="stringliteral">&#39;Current frame: %d; Total number of frame %d&#39;</span>,1, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.upFrames,<span class="stringliteral">&#39;Title&#39;</span>,<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.pmPart,<span class="stringliteral">&#39;string&#39;</span>,num2str( (1:length(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f))<span class="stringliteral">&#39; ));</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="stringliteral">    elseif handles.f == 0</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="stringliteral">        set( handles.up1,&#39;</span><a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a><span class="charliteral">&#39;,&#39;</span>No files...<span class="stringliteral">&#39; );</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="stringliteral">        set(handles.slFrames,&#39;</span>enable<span class="charliteral">&#39;,&#39;</span><a class="code" href="_pike_reader_8m.html#a835accca41274fb237599d9b3c117fcf">off</a><span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="stringliteral">        S = sprintf(&#39;</span>Current <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a>: %d; Total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> %d<span class="stringliteral">&#39;,0, 0);</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="stringliteral">        set(handles.upFrames,&#39;</span>Title<span class="stringliteral">&#39;,S);</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="stringliteral">        return</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="stringliteral">handles.nom = 1;</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="stringliteral">Frame = FrameRider(hObject,handles);</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="stringliteral">handles.cF = Frame;</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="stringliteral">guidata(hObject,handles);</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="stringliteral">% --- Executes on button press in chR.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="stringliteral">function chR_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="stringliteral">% hObject    handle to chR (see GCBO)</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of chR</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="stringliteral">function edR_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="stringliteral">% hObject    handle to edR (see GCBO)</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edR as text</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edR as a double</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="stringliteral">function edR_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="stringliteral">% hObject    handle to edR (see GCBO)</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="stringliteral">% --- Executes on button press in chG.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="stringliteral">function chG_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="stringliteral">% hObject    handle to chG (see GCBO)</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of chG</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="stringliteral">function edG_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="stringliteral">% hObject    handle to edG (see GCBO)</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edG as text</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edG as a double</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="stringliteral">function edG_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="stringliteral">% hObject    handle to edG (see GCBO)</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="stringliteral">% --- Executes on button press in chB.</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="stringliteral">function chB_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="stringliteral">% hObject    handle to chB (see GCBO)</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of chB</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral">function edB_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">% hObject    handle to edB (see GCBO)</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edB as text</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edB as a double</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="stringliteral">function edB_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="stringliteral">% hObject    handle to edB (see GCBO)</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="stringliteral">% --- Executes on button press in chAdjust.</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="stringliteral">function chAdjust_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="stringliteral">% hObject    handle to chAdjust (see GCBO)</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of chAdjust</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="stringliteral">function edAdjust_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="stringliteral">% hObject    handle to edAdjust (see GCBO)</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edAdjust as text</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edAdjust as a double</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="stringliteral">function edAdjust_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="stringliteral">% hObject    handle to edAdjust (see GCBO)</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="stringliteral">% --- Executes on button press in pbSumFrames.</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="stringliteral">function pbSumFrames_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="stringliteral">% this function calculates sum of frames</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="stringliteral">%</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="stringliteral">handles.nom = 1;</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="stringliteral">Frame = FrameRider(hObject,handles);</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="stringliteral">handles.sF = zeros( size( Frame ) );</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="stringliteral">count_step = str2double( get(handles.edSumFrameStep,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;) );</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="stringliteral">wb = waitbar(0,&#39;</span>Processing<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="stringliteral">if iscell( handles.f )</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="stringliteral">    Nom = size( handles.f, 2 );</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="stringliteral">    for ii = 1 : Nom</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="stringliteral">        waitbar(ii/Nom,wb,[&#39;</span>Processing segment number <span class="stringliteral">&#39; num2str(ii) &#39;</span> from <span class="stringliteral">&#39; num2str(Nom)]);</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="stringliteral">        path = [handles.dir handles.f{ii}];</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="stringliteral">        inf = aviinfo( path );</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="stringliteral">        for j = 1:count_step:inf.NumFrames</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="stringliteral">            handles.nom = j;</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="stringliteral">            Frame = FrameRider(hObject,handles);</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="stringliteral">            handles.sF = handles.sF + Frame;</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="stringliteral">        end</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="stringliteral">elseif ischar( handles.f )</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="stringliteral">    path = [ handles.dir handles.f ];</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="stringliteral">    inf = aviinfo( path );</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="stringliteral">    for j = 1:count_step:inf.NumFrames-1</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="stringliteral">        waitbar(j/inf.NumFrames,wb,&#39;</span>Processing...<span class="stringliteral">&#39;);        </span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="stringliteral">        handles.nom = j;</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="stringliteral">        Frame = FrameRider(hObject,handles);</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="stringliteral">        handles.sF = handles.sF + Frame;</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="stringliteral">close(wb);  </span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="stringliteral">guidata( hObject, handles );</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="stringliteral">handles = Draw( hObject, handles );</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="stringliteral">function edSumFrameStep_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="stringliteral">% hObject    handle to edSumFrameStep (see GCBO)</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edSumFrameStep as text</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edSumFrameStep as a double</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="stringliteral">function edSumFrameStep_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="stringliteral">% hObject    handle to edSumFrameStep (see GCBO)</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="stringliteral">% --- Executes on button press in chSumFrames.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="stringliteral">function chSumFrames_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="stringliteral">% hObject    handle to chSumFrames (see GCBO)</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of chSumFrames</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="stringliteral">% --- Executes on button press in chSight.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="stringliteral">function chSight_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="stringliteral">% hObject    handle to chSight (see GCBO)</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">if get(hObject,&#39;</span>value<span class="stringliteral">&#39;)~=1</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="stringliteral">      set(handles.hl(1),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="stringliteral">            set(handles.hl(2),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="stringliteral">            set(handles.hl(3),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="stringliteral">            set(handles.hl(4),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="stringliteral">            set(handles.hl(5),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="stringliteral">            set(handles.hl(6),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="stringliteral">            set(handles.hl(7),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral">            set(handles.hl(8),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">            set(handles.hl(9),&#39;</span>xdata<span class="stringliteral">&#39;,[0,0],&#39;</span>ydata<span class="stringliteral">&#39;,[0,0]);</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="stringliteral">% --- Executes on slider movement.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="stringliteral">function slFrames_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="stringliteral">% hObject    handle to slFrames (see GCBO)</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="stringliteral">    handles.nom  = round(get(handles.slFrames,&#39;</span>value<span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="stringliteral">    set(handles.upFrames,&#39;</span><a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a><span class="stringliteral">&#39;,num2str(handles.nom));</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="stringliteral">    Frame = FrameRider(hObject,handles);</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="stringliteral">    handles.cF = Frame;</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="stringliteral">    guidata(hObject, handles);</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="stringliteral">    handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="stringliteral">    S = sprintf(&#39;</span>Current <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a>: %d; Total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> %d<span class="stringliteral">&#39;,handles.nom, handles.N_frames);</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="stringliteral">        set(handles.upFrames,&#39;</span>Title<span class="stringliteral">&#39;,S);</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns position of slider</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="stringliteral">%        get(hObject,&#39;</span>Min<span class="stringliteral">&#39;) and get(hObject,&#39;</span>Max<span class="stringliteral">&#39;) to determine range of slider</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="stringliteral">function slFrames_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="stringliteral">% hObject    handle to slFrames (see GCBO)</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="stringliteral">% Hint: slider controls usually have a light gray background.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="stringliteral">if isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;,[.9 .9 .9]);</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="stringliteral">% --- Executes on selection change in pmPart.</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="stringliteral">function pmPart_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="stringliteral">% hObject    handle to pmPart (see GCBO)</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="stringliteral">    vel = get(handles.pmPart,&#39;</span>value<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="stringliteral">    handles.fn = [handles.dir handles.f{vel}];</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="stringliteral">    inf = aviinfo(handles.fn);</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="stringliteral">    set(handles.slFrames,&#39;</span><a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a><span class="stringliteral">&#39;,inf.NumFrames,&#39;</span>min<span class="stringliteral">&#39;,1,&#39;</span>value<span class="stringliteral">&#39;,1,...</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="stringliteral">        &#39;</span>sliderstep<span class="stringliteral">&#39;,[1/inf.NumFrames 10/inf.NumFrames]);</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="stringliteral">    handles.nom = 1;</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="stringliteral">    Frame = FrameRider(hObject,handles);</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="stringliteral">    handles.cF = Frame;</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="stringliteral">    handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="stringliteral">    S = sprintf(&#39;</span>Current <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a>: %d; Total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> %d<span class="stringliteral">&#39;,handles.nom, handles.N_frames);</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="stringliteral">    set(handles.upFrames,&#39;</span>Title<span class="stringliteral">&#39;,S);</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="stringliteral">    guidata(hObject,handles);</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="stringliteral">% Hints: contents = get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns pmPart contents as cell array</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="stringliteral">%        contents{get(hObject,&#39;</span>Value<span class="stringliteral">&#39;)} returns selected item from pmPart</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="stringliteral">function pmPart_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="stringliteral">% hObject    handle to pmPart (see GCBO)</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="stringliteral">% Hint: popupmenu controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="stringliteral">% --- Executes on button press in rbR.</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="stringliteral">function rbR_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="stringliteral">% hObject    handle to rbR (see GCBO)</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="stringliteral">set(handles.rbG,&#39;</span>value<span class="stringliteral">&#39;,0);</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="stringliteral">set(handles.rbB,&#39;</span>value<span class="stringliteral">&#39;,0);</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of rbR</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="stringliteral">% --- Executes on button press in rbG.</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="stringliteral">function rbG_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="stringliteral">% hObject    handle to rbG (see GCBO)</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral">set(handles.rbB,&#39;</span>value<span class="stringliteral">&#39;,0);</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral">set(handles.rbR,&#39;</span>value<span class="stringliteral">&#39;,0);</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of rbG</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="stringliteral">% --- Executes on button press in rbB.</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="stringliteral">function rbB_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="stringliteral">% hObject    handle to rbB (see GCBO)</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="stringliteral">set(handles.rbG,&#39;</span>value<span class="stringliteral">&#39;,0);</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="stringliteral">set(handles.rbR,&#39;</span>value<span class="stringliteral">&#39;,0);</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="stringliteral">% Hint: get(hObject,&#39;</span>Value<span class="stringliteral">&#39;) returns toggle state of rbB</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="stringliteral">function edPdrop_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="stringliteral">% hObject    handle to edPdrop (see GCBO)</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edPdrop as text</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edPdrop as a double</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="stringliteral">function edPdrop_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="stringliteral">% hObject    handle to edPdrop (see GCBO)</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="stringliteral">function edCCD_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="stringliteral">% hObject    handle to edCCD (see GCBO)</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="stringliteral">handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edCCD as text</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edCCD as a double</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="stringliteral">function edCCD_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="stringliteral">% hObject    handle to edCCD (see GCBO)</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="stringliteral">function edAperture_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="stringliteral">% hObject    handle to edAperture (see GCBO)</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="stringliteral"> handles = Draw(hObject,handles);</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="stringliteral">% Hints: get(hObject,&#39;</span>String<span class="stringliteral">&#39;) returns contents of edAperture as text</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="stringliteral">%        str2double(get(hObject,&#39;</span>String<span class="stringliteral">&#39;)) returns contents of edAperture as a double</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="stringliteral">% --- Executes during object creation, after setting all properties.</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="stringliteral">function edAperture_CreateFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="stringliteral">% hObject    handle to edAperture (see GCBO)</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="stringliteral">% handles    empty - handles not created until after all CreateFcns called</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="stringliteral">% Hint: edit controls usually have a white background on Windows.</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="stringliteral">%       See ISPC and COMPUTER.</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="stringliteral">if ispc &amp;&amp; isequal(get(hObject,&#39;</span>BackgroundColor<span class="stringliteral">&#39;), get(0,&#39;</span>defaultUicontrolBackgroundColor<span class="stringliteral">&#39;))</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="stringliteral">    set(hObject,&#39;</span>BackgroundColor<span class="charliteral">&#39;,&#39;</span>white<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="stringliteral">% --- Executes on mouse motion over figure - except title and menu.</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="stringliteral">function Fig1_WindowButtonMotionFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="stringliteral">% hObject    handle to Fig1 (see GCBO)</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="stringliteral">% get(hObject,&#39;</span>CurrentPoint<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="stringliteral">% --- Executes on mouse press over axes background.</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="stringliteral">function axes1_ButtonDownFcn(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="stringliteral">% hObject    handle to axes1 (see GCBO)</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="stringliteral">% get(hObject,&#39;</span>CurrentPoint<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="stringliteral">% --- Executes on button press in pbAngleCalc.</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="stringliteral">function pbAngleCalc_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="stringliteral">% This function calculates correct angles distribution for the image with</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="stringliteral">% aberration.</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="stringliteral">%    handles = AnglesCalculator(handles);</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="stringliteral">%    guidata(hObject,handles);</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="stringliteral">% --- Executes on button press in pbIntensCalc.</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="stringliteral">function pbIntensCalc_Callback(hObject, eventdata, handles)</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="stringliteral">% hObject    handle to pbIntensCalc (see GCBO)</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="stringliteral">% eventdata  reserved - to be defined in a future version of MATLAB</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="stringliteral">% handles    structure with handles and user data (see GUIDATA)</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="stringliteral">handles.NP = 700; % Number of angle points</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="stringliteral">step=single(64);</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="stringliteral">ipR=zeros(0,&#39;</span>int32<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="stringliteral">ipG=zeros(0,&#39;</span>int32<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="stringliteral">ipB=zeros(0,&#39;</span>int32<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="stringliteral">ICR_N=zeros(0,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="stringliteral">ICG_N=zeros(0,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="stringliteral">ICB_N=zeros(0,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="stringliteral">I_S_R=zeros(0,&#39;</span>int32<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="stringliteral">I_S_G=zeros(0,&#39;</span>int32<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="stringliteral">I_S_B=zeros(0,&#39;</span>int32<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="stringliteral">ThetaR_S=zeros(1,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="stringliteral">ThetaG_S=zeros(1,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="stringliteral">ThetaB_S=zeros(1,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="stringliteral">% Movie length estimation  </span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="stringliteral"> count_step = str2double( get(handles.edFrameStep,&#39;</span><span class="keywordtype">string</span><span class="stringliteral">&#39;));</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="stringliteral"> handles.N_frames = 0;</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="stringliteral">if iscell( handles.f ) % In case of multi select function is enabled</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="stringliteral">    Nom = size( handles.f, 2 );</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="stringliteral">    for ii = 1 : Nom  % Number of moves parts</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="stringliteral">        path = [handles.dir handles.f{ii}];</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="stringliteral">        inf = aviinfo( path );</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="stringliteral">%    we should remember that quality of the last frame is not good     </span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="stringliteral">        handles.N_frames = handles.N_frames + length(1:count_step:inf.NumFrames-1);</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="stringliteral">    end</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="stringliteral">elseif ischar( handles.f ) % The single file is chosen</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="stringliteral">    path = [ handles.dir handles.f ];</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="stringliteral">    inf = aviinfo( path );</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="stringliteral">    handles.N_frames = length(1:count_step:inf.NumFrames-1);</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="stringliteral">% According to chosen checkbox:</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="stringliteral"> </span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="stringliteral">if get(handles.chR,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="stringliteral">    ipR = find(handles.BWR&#39;</span>); % Searching <span class="keywordflow">for</span> a good pixels related to the mask</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    ThR=<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.THETA_R<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="stringliteral">    ThetaR = 180*ThR(ipR)/pi;   % There is a problem with beam direction.</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="stringliteral">                                            % We have to add 90 degree or 270 according to beam direction.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="stringliteral">    [ThetaR_S,I_S_R] = sort(ThetaR);        % It is better to work with sorted ( ordered ) data                                    </span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="stringliteral">    I_S_R=single(I_S_R);</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="stringliteral">    % Reduction of points    </span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="stringliteral">    deltaT_R = ( ThetaR_S(end)-ThetaR_S(1) ) / handles.NP; % Angle&#39;</span><a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> step</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    I_Red = single(<a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.NP )); % Creation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> empty <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> <span class="keywordflow">for</span> intensity recording</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    nThetaR = single(<a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>( 1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.NP ));          % Angles vector</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    icr=<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.ICR<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="stringliteral">    ICR_N = icr(ipR);                 % Correction </span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="stringliteral">    ICR_N = ICR_N./max(ICR_N(:));             % Normalised intensity correction vector</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="stringliteral">if get(handles.chG,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="stringliteral">    ipG = find(handles.BWG&#39;</span>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    ThG=<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.THETA_G<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="stringliteral">    ThetaG = 180*ThG(ipG)/pi;          % There is a problem with beam direction.</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="stringliteral">                                                   % We have to add 90 degree or 270 according to beam direction.</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="stringliteral">    [ThetaG_S,I_S_G] = sort(ThetaG);               % It is better to work with sorted ( ordered ) data</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="stringliteral">    I_S_G=single(I_S_G);</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="stringliteral">    % Reduction of points  </span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="stringliteral">    deltaT_G = ( ThetaG_S(end)-ThetaG_S(1) ) / handles.NP; % Angle&#39;</span><a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> step</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    I_Green = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.NP);   % Creation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> empty <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> <span class="keywordflow">for</span> intensity recording</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    nThetaG = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>( 1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.NP ); </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    icg=<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.ICG<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="stringliteral">    ICG_N = icg(ipG);</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="stringliteral">    ICG_N = ICG_N./max(ICG_N(:));                  % Normalised intensity correction vector</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="stringliteral">if get(handles.chB,&#39;</span>value<span class="stringliteral">&#39;)</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="stringliteral">    ipB = find(handles.BWB&#39;</span>);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    ThB=<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.THETA_B<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="stringliteral">    ThetaB = 180*ThB(ipB)/pi;  % There is a problem with beam direction.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="stringliteral">                                           % We have to add 90 degree or 270 according to beam direction.</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="stringliteral">    [ThetaB_S,I_S_B] = sort(ThetaB);               % It is better to work with sorted ( ordered ) data</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="stringliteral">    I_S_B=single(I_S_B);</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="stringliteral">    % Reduction of points</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="stringliteral">    deltaT_B = ( ThetaB_S(end)-ThetaB_S(1) ) / handles.NP; % Angle&#39;</span><a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> step</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    I_Blue = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.NP); % Creation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> empty <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> <span class="keywordflow">for</span> intensity recording  </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    nThetaB = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>( 1,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.NP );</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    icb=<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.ICB<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="stringliteral">    ICB_N = icb( ipB );</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="stringliteral">    ICB_N = ICB_N./max( ICB_N(:) ); </span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="stringliteral">                                        </span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="stringliteral">% </span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="stringliteral">% Preparing to read the data from the move file</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="stringliteral">% </span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="stringliteral">% Calculation of reduction coefficient:</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="stringliteral">wb_s = &#39;</span>Time estimation...<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="stringliteral">wb = waitbar( 0, wb_s );</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="stringliteral">if iscell( handles.f ) % In case of multi select function is enabled</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="stringliteral">    Nom = size( handles.f, 2 );</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="stringliteral">    count = 1;</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="stringliteral">  %% FIXME: could be sped up!!! with GPU  </span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="stringliteral">  ite=0;</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="stringliteral">  %itb=1;</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="stringliteral">  ats=tic;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="stringliteral">    for ii = 1 : Nom  % Number of moves parts</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="stringliteral">        waitbar(ii/Nom,wb,wb_s);</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="stringliteral">        tts=tic;</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="stringliteral">        path = [handles.dir handles.f{ii}];</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="stringliteral">        inf = aviinfo( path );</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="stringliteral">        if handles.GPU==1</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="stringliteral">        %handles.fn=handles.f{ii};</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="stringliteral">        handles.fn=path;</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="stringliteral">        itb=ite+1;</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="stringliteral">        ite=ite+inf.NumFrames;</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="stringliteral">     %I_RedM=zeros(700,inf.NumFrames,&#39;</span>single<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="stringliteral">%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="stringliteral">[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(inf.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="stringliteral">    I_Red(itb:ite,:)=I_RedM&#39;</span>;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    I_Green(itb:ite,:)=I_GreenM<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="stringliteral">    I_Blue(itb:ite,:)=I_BlueM&#39;</span>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;     tt=<a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a>(tts)</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        else</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;         </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;       for1 = <a class="code" href="_pike_reader_8m.html#a8fb092330ecda60587643305d0d9738a">tic</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        for <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 1:count_step:<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames % Numbers <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> frames</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.nom = <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            Frame = FrameRider(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;       %  The red channel is chosen</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chR,&#39;value&#39;)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                Red = Frame(:,:,1);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                  Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                  <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    Ir = MovingAverage(Ir, I_S_R, step);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                    [nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                  else</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                  nom = 1;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                % Reduction <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                  while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                      ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                     </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                      <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(ind)&gt;0</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                          nThetaR(nom) = mean(ThetaR_S(ind));</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                          I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                      else</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                          nThetaR(nom) = nThetaR(nom-1);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                          I_Red(count,nom) = I_Red(count,nom-1);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                      end</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                      nom = nom + 1;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                      </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                  end</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                  end</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            end</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        %  The green channel is chosen</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chG,&#39;value&#39;)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                Green = Frame(:,:,2);</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                  Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                  <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                    Ig = MovingAverage(Ig, I_S_G, step);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                    [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                  else</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                  nom = 1;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                % Reduction <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                  while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                      ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                      <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(ind)&gt;0</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                          nThetaG(nom) = mean(ThetaG_S(ind));</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                          I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                      else</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                          nThetaG(nom) = nThetaG(nom-1);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                          I_Green(count,nom) = I_Green(count,nom-1);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                      end</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                     </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                      nom = nom + 1;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                  end</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                  end</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            end</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        %  The blue channel is chosen</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chB,&#39;value&#39;)</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                Blue = Frame(:,:,3);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                  Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                  <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                    Ib = MovingAverage(Ib, I_S_B,step);</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                    [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                  else</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                  nom = 1;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                % Reduction <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                  while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                      ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                      <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(ind)&gt;0</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                          nThetaB(nom) = mean(ThetaB_S(ind));</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                          I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                      else</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                          nThetaB(nom) = nThetaB(nom-1);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                          I_Blue(count,nom) = I_Blue(count,nom-1);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                      end</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                      nom = nom + 1;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                  end</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                  end</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            end</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;             count = count+1;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        end</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        tt = <a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a>(for1);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        end</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;       </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        wb_s = sprintf(&#39;Processing segment number %1.0<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a> from %1.0<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a> \<a class="code" href="_ray_tracing_8m.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a> Remaining time: %<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> .&#39;,...</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                       <a class="code" href="_pike_reader_8m.html#abf9d47cd7d4fbc942e618bb1977019c2">ii</a>,Nom,datestr(datenum(0,0,0,0,0,(tt*(Nom-ii))),&#39;HH:MM:SS&#39;));</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    end</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a>(ats)</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;     </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<a class="code" href="nvmex__helper_8m.html#a52e3417805be73af234040a44925af06">elseif</a> <a class="code" href="_pike_reader_8m.html#aae1d1bec0e9c36c2fddc5cd87d8c4eee">ischar</a>( handles.<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a> ) % The single <a class="code" href="_avi_read_pike___split_8m.html#a53be3e8a3476298b0e2ca95e4fa573fc">file</a> is chosen</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;     <a class="code" href="_pike_reader_8m.html#a7ca9388205808cde238c5d87083a3f02">path</a>  = [ handles.dir handles.<a class="code" href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a> ];</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;     </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;     <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;     tic;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;     <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames &lt;= <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.FileSize/(640*480*2+8)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            handles.N_frames = <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames; % total number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> frames</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        else</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            handles.N_frames = <span class="keywordtype">double</span>(int32((<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.FileSize-64564)/(640*480*2+8))-2);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        end</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;%[I_Red,I_Green,I_Blue,prevF,prevR,prevRC,prevRS]=IntensCalc(handles,int32(count_step),int32(<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;[I_RedM,I_GreenM,I_BlueM]=IntensCalc(handles,int32(count_step),int32(handles.N_frames),int32(ipR),int32(ipG),int32(ipB),ICR_N,ICG_N,ICB_N,int32(I_S_R),int32(I_S_G),int32(I_S_B));</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;I_Red=I_RedM&#39;;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    I_Green=I_GreenM&#39;;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    I_Blue=I_BlueM&#39;;     </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;     nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;     nThetaG(:)=ThetaG_S(int32(linspace(1,length(ThetaG_S),700)));</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;     nThetaB(:)=ThetaB_S(int32(linspace(1,length(ThetaB_S),700)));</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;     else</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;     count = 1;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;     for j = 1:count_step:<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames-1</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;         waitbar(j/<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames,wb,wb_s);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         tic;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;         handles.nom = j;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;         Frame = FrameRider(hObject,handles);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;         %  The red channel is chosen</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;         <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chR,&#39;value&#39;)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;             Red = Frame(:,:,1)&#39;;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;             Ir = Red(ipR)./ICR_N; % Reading and correcting intensity vector</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;             </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;             <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                 Ir = MovingAverage(Ir, I_S_R, step);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                 I_Red(count,:)=Ir(int32(linspace(1,length(Ir),700)));</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                 nThetaR(:)=ThetaR_S(int32(linspace(1,length(ThetaR_S),700)));</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                 %[nThetaR(:), I_Red(count,:)]=ReducedMean(ThetaR_S, deltaT_R, Ir, single(1:length(Ir)));</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;             else</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;             </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;             nom = 1;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;             % Reduction <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;             while (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S(end)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                 ind = ( ( ( (ThetaR_S(1)+deltaT_R*nom) &lt;= ThetaR_S ) ) &amp; ( ( (ThetaR_S(1)+deltaT_R*(nom+1) ) &gt;= ThetaR_S )  ) );</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                 <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(ind)&gt;0</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                     nThetaR(nom) = mean(ThetaR_S(ind));</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                     I_Red(count,nom) = mean( Ir( I_S_R(ind) ) );</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                 else</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                     nThetaR(nom) = nThetaR(nom-1);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                     I_Red(count,nom) = I_Red(count,nom-1);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                 end</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                 nom = nom + 1;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;             end</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;             </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;             end</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;         end</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;         </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;         %  The green channel is chosen</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;         <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chG,&#39;value&#39;)</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;             Green = Frame(:,:,2);</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;             Ig = Green(ipG)./ICG_N; % Reading and correcting intensity vector</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;             <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                 Ig = MovingAverage(Ig, I_S_G, step);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                 [nThetaG(:), I_Green(count,:)]=ReducedMean(ThetaG_S, deltaT_G, Ig, single(1:length(Ig)));</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;             else</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;             nom = 1;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;             % Reduction <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;             while (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S(end)</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                 ind = ( ( ( (ThetaG_S(1)+deltaT_G*nom) &lt;= ThetaG_S ) ) &amp; ( ( (ThetaG_S(1)+deltaT_G*(nom+1) ) &gt;= ThetaG_S )  ) );</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                 <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(ind)&gt;0</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                     nThetaG(nom) = mean(ThetaG_S(ind));</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                     I_Green(count,nom) = mean( Ig( I_S_G(ind) ) );</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                 else</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                     nThetaG(nom) = nThetaG(nom-1);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                     I_Green(count,nom) = I_Green(count,nom-1);</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                 end</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                 nom = nom + 1;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;             end</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;             end</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;         end</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;         </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;         %  The blue channel is chosen</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;         <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chB,&#39;value&#39;)</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;             Blue = Frame(:,:,3);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;             Ib = Blue(ipB)./ICB_N; % Reading and correcting intensity vector</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;             <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>==1</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                 Ib = MovingAverage(Ib, I_S_B,step);</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                 [nThetaB(:), I_Blue(count,:)]=ReducedMean(ThetaB_S, deltaT_B, Ib, single(1:length(Ib)));</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;             else</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;             nom = 1;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;             % Reduction <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> number <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> points</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;             while (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S(end)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                 ind = ( ( ( (ThetaB_S(1)+deltaT_B*nom) &lt;= ThetaB_S ) ) &amp; ( ( (ThetaB_S(1)+deltaT_B*(nom+1) ) &gt;= ThetaB_S )  ) );</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                 <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(ind)&gt;0</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                     nThetaB(nom) = mean(ThetaB_S(ind));</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                     I_Blue(count,nom) = mean( Ib( I_S_B(ind) ) );</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                 else</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                     nThetaB(nom) = nThetaB(nom-1);</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                     I_Blue(count,nom) = I_Blue(count,nom-1);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                 end</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                 nom = nom + 1;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;             end</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;             end</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;         end</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;         tt = <a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a>;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;         wb_s = sprintf(&#39;Processing <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> number %1.0f from %1.0f \<a class="code" href="_ray_tracing_8m.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a> Remaining time: %s .&#39;,...</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;             j,<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames-1,datestr(datenum(0,0,0,0,0,(tt*((<a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames-j)/count_step))),&#39;HH:MM:SS&#39;));</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;         </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;             count = count + 1;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;     end</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;     end</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;     </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;end</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;     <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chR,&#39;value&#39;)</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;         assignin(&#39;base&#39;,&#39;I_R&#39;,I_Red);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;         assignin(&#39;base&#39;,&#39;ThetaR&#39;,nThetaR);</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;     end</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;     <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chG,&#39;value&#39;)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;         assignin(&#39;base&#39;,&#39;I_G&#39;,I_Green);</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         assignin(&#39;base&#39;,&#39;ThetaG&#39;,nThetaG);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;     end</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;     <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chB,&#39;value&#39;)</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;         assignin(&#39;base&#39;,&#39;I_B&#39;,I_Blue);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;         assignin(&#39;base&#39;,&#39;ThetaB&#39;,nThetaB);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;     end</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;     <a class="code" href="_pike_reader_8m.html#a1e9b0febbb137ecc9c2e2a5c34f66184">close</a>(wb);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;   <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> edLineSh_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;% hObject    handle to edLineSh (see GCBO)</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;handles = Draw(hObject,handles);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;% Hints: <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(hObject,&#39;String&#39;) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> edLineSh as text</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;%        str2double(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(hObject,&#39;String&#39;)) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> edLineSh as a <span class="keywordtype">double</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;% --- Executes during <span class="keywordtype">object</span> creation, after setting all properties.</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> edLineSh_CreateFcn(hObject, eventdata, handles)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;% hObject    handle to edLineSh (see GCBO)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;% handles    empty - handles not created until after all CreateFcns called</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;% Hint: <a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a> controls usually have a white background on Windows.</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;%       See ISPC and COMPUTER.</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> ispc &amp;&amp; isequal(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(hObject,&#39;BackgroundColor&#39;), <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(0,&#39;defaultUicontrolBackgroundColor&#39;))</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;end</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;% --- Executes on button press in pbLoadParam.</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> pbLoadParam_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;% hObject    handle to pbLoadParam (see GCBO)</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    Save = evalin(&#39;base&#39;,&#39;Save&#39;);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;% loading checkbox structure</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.chR,&#39;value&#39;,Save.chR_value);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.chG,&#39;value&#39;,Save.chG_value);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.chB,&#39;value&#39;,Save.chB_value);  </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  %---</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.chSight,&#39;value&#39;,Save.chSight);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.chAdjust,&#39;value&#39;,Save.chAdjust);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;% Loading <a class="code" href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">lambda</a> <a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a> boxes</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edR,&#39;<span class="keywordtype">string</span>&#39;,Save.edR);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edG,&#39;<span class="keywordtype">string</span>&#39;,Save.edG);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edB,&#39;<span class="keywordtype">string</span>&#39;,Save.edB);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;% Loading position paramiters</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edPdrop,&#39;<span class="keywordtype">string</span>&#39;,Save.<a class="code" href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a>);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edCCD,&#39;<span class="keywordtype">string</span>&#39;,Save.edCCD);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edAperture,&#39;<span class="keywordtype">string</span>&#39;,Save.edAperture);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edLineSh,&#39;<span class="keywordtype">string</span>&#39;,Save.<a class="code" href="_pike_reader_8m.html#ab9f9228dbcac2043ba4424e683ffc8b6">shLW</a>);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.ed_Sh_l1,&#39;<span class="keywordtype">string</span>&#39;,Save.ed_Sh_l1);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;% Loading <a class="code" href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a> step and Adjust box    </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edAdjust,&#39;<span class="keywordtype">string</span>&#39;,Save.edAdjust);</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edSumFrameStep,&#39;<span class="keywordtype">string</span>&#39;,Save.edSumFrameStep);</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(handles.edFrameStep,&#39;<span class="keywordtype">string</span>&#39;,Save.edFrameStep);</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;% Loading ThetaPhiR structure</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    % Saving angles and masks</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;%      --  masks --</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a2aedde79552f40449090018d231fa562">BWR</a> = Save.<a class="code" href="_pike_reader_8m.html#a2aedde79552f40449090018d231fa562">BWR</a>;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a2f93ba66296f970945973536ac7bfa87">BWG</a> = Save.<a class="code" href="_pike_reader_8m.html#a2f93ba66296f970945973536ac7bfa87">BWG</a>;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#ada0d3b3c6dbb4f469da7e20a519437fd">BWB</a> = Save.<a class="code" href="_pike_reader_8m.html#ada0d3b3c6dbb4f469da7e20a519437fd">BWB</a>;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;%      --  border <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks --</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    handles.R_position = Save.R_position;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    handles.G_position = Save.G_position;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    handles.B_position = Save.B_position;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;% Correction masks</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    handles.ICR = Save.ICR;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">ICG</a> = Save.<a class="code" href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">ICG</a>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    handles.ICB = Save.ICB;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;% Angles <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a>    </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    handles.THETA_R = Save.THETA_R;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    handles.THETA_G = Save.THETA_G;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    handles.THETA_B = Save.THETA_B;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;%      ---    </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    handles.PHI_R   = Save.PHI_R;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    handles.PHI_G   = Save.PHI_G;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    handles.PHI_B   = Save.PHI_B;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    handles = Draw(hObject,handles);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;% --- Executes on button press in pbSaveParam.</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> pbSaveParam_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;% hObject    handle to pbSaveParam (see GCBO)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;% </div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;% Saving checkbox structure</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    Save.chR_value = get(handles.chR,&#39;value&#39;);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    Save.chG_value = get(handles.chG,&#39;value&#39;);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    Save.chB_value = get(handles.chB,&#39;value&#39;);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;%---</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    Save.chAdjust  = get(handles.chAdjust,&#39;value&#39;);</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    Save.chSight   = get(handles.chSight,&#39;value&#39;);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;% Saving <a class="code" href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">lambda</a> <a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a> boxes</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    Save.edR = get(handles.edR,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    Save.edG = get(handles.edG,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    Save.edB = get(handles.edB,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;% Saving position paramiters</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    Save.Pk    = get(handles.edPdrop,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    Save.edCCD = get(handles.edCCD,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    Save.edAperture = get(handles.edAperture,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    Save.shLW     = get(handles.edLineSh,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    Save.ed_Sh_l1 = get(handles.ed_Sh_l1,&#39;<span class="keywordtype">string</span>&#39;); % distance between lenses</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;% Saving Frame step and Adjust box</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    Save.edAdjust = get(handles.edAdjust,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    Save.edSumFrameStep = get(handles.edSumFrameStep,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    Save.edFrameStep = get(handles.edFrameStep,&#39;<span class="keywordtype">string</span>&#39;);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;% Saving angles and masks</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;%      --  masks --</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    Save.BWR = handles.BWR;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    Save.BWG = handles.BWG;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    Save.BWB = handles.BWB;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;%      --  border <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks --</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    Save.R_position = handles.R_position;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    Save.G_position = handles.G_position;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    Save.B_position = handles.B_position;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;% Correction masks</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    Save.ICR = handles.ICR;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    Save.ICG = handles.ICG;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    Save.ICB = handles.ICB;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;% Angles <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a>    </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    Save.THETA_R = handles.THETA_R;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    Save.THETA_G = handles.THETA_G;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    Save.THETA_B = handles.THETA_B;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;%      ---    </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    Save.PHI_R   = handles.PHI_R;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    Save.PHI_G   = handles.PHI_G;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    Save.PHI_B   = handles.PHI_B;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    handles.dir;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    savePath = [ handles.dir &#39;SaveParams.mat&#39;];</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> exist(savePath)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    % File exist!</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;       button = questdlg(&#39;File already exists!&#39;,&#39;Warning!!!&#39;,&#39;Rewrite&#39;,&#39;NO&#39;,&#39;Cancel&#39;,&#39;Cancel&#39;);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;       switch button</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;           case &#39;Rewrite&#39;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;               <a class="code" href="_pike_reader_8m.html#a7de0a9938c22cb89998f4b33689f73a5">save</a>(savePath,&#39;Save&#39;);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;               sprintf(&#39;Parameters has been saved to the directory:\<a class="code" href="_ray_tracing_8m.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a> %s&#39;,savePath)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;           case &#39;NO&#39;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;             [<a class="code" href="_avi_read_pike___split_8m.html#a53be3e8a3476298b0e2ca95e4fa573fc">file</a>,<a class="code" href="_pike_reader_8m.html#a7ca9388205808cde238c5d87083a3f02">path</a>] = uiputfile(&#39;SaveParams_1.mat&#39;,&#39;Save file name&#39;, savePath);  </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;             <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> file == 0</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                 return;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;             end;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;               savePath =[<a class="code" href="_pike_reader_8m.html#a7ca9388205808cde238c5d87083a3f02">path</a>,file];</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;               <a class="code" href="_pike_reader_8m.html#a7de0a9938c22cb89998f4b33689f73a5">save</a>(savePath,&#39;Save&#39;);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;               sprintf(&#39;Parameters has been saved to the directory:\<a class="code" href="_ray_tracing_8m.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a> %s&#39;,savePath)</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;           otherwise</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;           </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;       end</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    else</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    % File dose not exist.</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <a class="code" href="_pike_reader_8m.html#a7de0a9938c22cb89998f4b33689f73a5">save</a>(savePath,&#39;Save&#39;);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        sprintf(&#39;Parameters has been saved to the directory:\<a class="code" href="_ray_tracing_8m.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a> %s&#39;,savePath)</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    end</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    assignin(&#39;base&#39;,&#39;Save&#39;,Save);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> ed_Sh_l1_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;% hObject    handle to ed_Sh_l1 (see GCBO)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;handles = Draw(hObject,handles);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;% Hints: get(hObject,&#39;String&#39;) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> ed_Sh_l1 as text</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;%        str2double(get(hObject,&#39;String&#39;)) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> ed_Sh_l1 as a <span class="keywordtype">double</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;% --- Executes during <span class="keywordtype">object</span> creation, after setting all properties.</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> ed_Sh_l1_CreateFcn(hObject, eventdata, handles)</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;% hObject    handle to ed_Sh_l1 (see GCBO)</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;% handles    empty - handles not created until after all CreateFcns called</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;% Hint: <a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a> controls usually have a white background on Windows.</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;%       See ISPC and COMPUTER.</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;end</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;% --- Executes on button press in pbNA_Aprox.</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> pbNA_Aprox_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;% hObject    handle to pbNA_Aprox (see GCBO)</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;Bw2 = roipoly(handles.<a class="code" href="_pike_reader_8m.html#aec2eeebd8d646ee2ebc719f72c9c7347">cF</a>(:,:,1),handles.<a class="code" href="_pike_reader_8m.html#a3640ad397933061adc052c623140eef9">R1</a>(1,:)+ handles.<a class="code" href="_pike_reader_8m.html#ade5833a0a85b9b718569df8e6db987da">TshX</a> + handles.<a class="code" href="_pike_reader_8m.html#a903dc30acce65e0358386b3e2e59d2ef">shX</a>,handles.R1(2,:)+ handles.<a class="code" href="_pike_reader_8m.html#a620c5047f94fcde614026a5718963c8b">TshY</a> + handles.<a class="code" href="_pike_reader_8m.html#aed35f423ca9aba8635f1fd5e4df75a65">shY</a>);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;Ap = <a class="code" href="_ray_tracing_8m.html#a9564846b4818d9eed8b0e902c97b942d">sum</a>(<a class="code" href="_ray_tracing_8m.html#a9564846b4818d9eed8b0e902c97b942d">sum</a>(Bw2,2)~=0);  % The aperture (diameter) <a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a> in [pix]</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;Apm = Ap*handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a141992195c618a3c78b87ed867206a34">PixSize</a>; % The aperture (diameter) <a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a> in [mm]</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;Phi = atan(handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a483471d881ab668d2b0837db0515bfb3">dH</a>/2/handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a92194e0fd585cf13a4a3b76420356158">R_dis_Ring</a>);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;LCCD = Apm/tan(Phi)/2; % The distance from lens to CCD element</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;% compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks   </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="keywordtype">id</span> = find(<a class="code" href="_ray_tracing_8m.html#a9564846b4818d9eed8b0e902c97b942d">sum</a>(handles.Bw,1)); % <span class="keywordtype">id</span> - non-zero pixels</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;NA_Theta = atan((<span class="keywordtype">id</span>-320+ handles.<a class="code" href="_pike_reader_8m.html#ade5833a0a85b9b718569df8e6db987da">TshX</a> + handles.shX)*handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.PixSize/LCCD);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<a class="code" href="demosaic__c__mex_8c.html#a60ef6e1bcfabb95cfeb300e1d03ce470">I</a> = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>( handles.N_frames, length(NA_Theta) );</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;nom = 1;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; wb = waitbar(0,&#39;Angle Calculation&#39;);</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160; <a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a>=0;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;for <a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 1 : length( handles.f ) % cycle by pieces <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> movie</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a53323a4c01bdc9e45b28410b296cb054">fn</a> = [handles.dir handles.f{<a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>}];</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a> = aviinfo(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.fn);</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">for</span> <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 1 : <a class="code" href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a>.NumFrames</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> = sprintf(<span class="stringliteral">&#39;Processing %d-th frame. \n Estimated time -&gt; %f[min]; time left %f&#39;</span>,...</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                     <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames*<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a>/60,(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.N_frames-nom)*<a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a>/60);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        waitbar(<a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/length( <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.f ),wb,<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a>);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        %  Choosing the channel</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.nom = <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.cF = FrameRider(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">get</span>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.rbR,<span class="stringliteral">&#39;value&#39;</span>)</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            Frame = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.cF(:,:,1);</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        end</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">get</span>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.rbG,<span class="stringliteral">&#39;value&#39;</span>)</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            Frame = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.cF(:,:,2);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        end</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">get</span>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.rbB,<span class="stringliteral">&#39;value&#39;</span>)</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            Frame = <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.cF(:,:,3);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        end</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;       <a class="code" href="_pike_reader_8m.html#a8fb092330ecda60587643305d0d9738a">tic</a>; </div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;     Temp =  mean(Frame.*<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.Bw,1);</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <a class="code" href="demosaic__c__mex_8c.html#a60ef6e1bcfabb95cfeb300e1d03ce470">I</a>(nom,:) =Temp(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <a class="code" href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a> = <a class="code" href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a>;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      nom = nom + 1;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    end</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;end</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<a class="code" href="_pike_reader_8m.html#a1e9b0febbb137ecc9c2e2a5c34f66184">close</a>(wb);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;assignin(<span class="stringliteral">&#39;base&#39;</span>,<span class="stringliteral">&#39;I_NA&#39;</span>,<a class="code" href="demosaic__c__mex_8c.html#a60ef6e1bcfabb95cfeb300e1d03ce470">I</a>);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;assignin(<span class="stringliteral">&#39;base&#39;</span>,<span class="stringliteral">&#39;Theta_NA&#39;</span>,NA_Theta)</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;% --------------------------------------------------------------------</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> muCI_Callback(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>, eventdata, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;% <a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>    handle to muCI (see GCBO)</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;% <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>    structure with <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a> and user data (see GUIDATA)</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;% --------------------------------------------------------------------</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> muCalcIm_Callback(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>, eventdata, <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>)</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;% The <a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> muCalcIm_Callback calculates the intensity <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> and angles</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;% <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.chR,&#39;value&#39;)</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">lambda</a> = str2double(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.edR,&#39;string&#39;));</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.m2 = Calculate_m(25,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.S.lambda, <span class="stringliteral">&#39;BK7&#39;</span>);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        [handles.ICR,handles.THETA_R,handles.PHI_R] =  IC_Calculation(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        %<a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.THETA_R)</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    end</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.chG,&#39;value&#39;)</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">lambda</a> = str2double(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.edG,&#39;<span class="keywordtype">string</span>&#39;));</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#adca714bf61ad7fb2fc07053ed7c43d40">m2</a> = Calculate_m(25,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">lambda</a>, &#39;<a class="code" href="_calculate__m_8m.html#a5a182ddedd82ee46f83d0aca23119410">BK7</a>&#39;);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        [<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.<a class="code" href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">ICG</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.THETA_G,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>.PHI_G] =  IC_Calculation(<a class="code" href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a>,<a class="code" href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a>);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    end</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.chB,&#39;value&#39;)</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.lambda = str2double(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(handles.edB,&#39;<span class="keywordtype">string</span>&#39;));</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#adca714bf61ad7fb2fc07053ed7c43d40">m2</a> = Calculate_m(25,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.lambda, &#39;BK7&#39;);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        [handles.ICB,handles.THETA_B,handles.PHI_B] =  IC_Calculation(hObject,handles);</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    end</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> edFrStep_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;% hObject    handle to edFrStep (see GCBO)</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;% Hints: <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(hObject,&#39;String&#39;) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> edFrStep as text</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;%        str2double(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(hObject,&#39;String&#39;)) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> edFrStep as a <span class="keywordtype">double</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;% --- Executes during <span class="keywordtype">object</span> creation, after setting all properties.</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> edFrStep_CreateFcn(hObject, eventdata, handles)</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;% hObject    handle to edFrStep (see GCBO)</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;% handles    empty - handles not created until after all CreateFcns called</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;% Hint: <a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a> controls usually have a white background on Windows.</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;%       See ISPC and COMPUTER.</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> ispc &amp;&amp; isequal(<a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(hObject,&#39;BackgroundColor&#39;), <a class="code" href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a>(0,&#39;defaultUicontrolBackgroundColor&#39;))</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;end</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> edFrameStep_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;% hObject    handle to edFrameStep (see GCBO)</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;% Hints: get(hObject,&#39;String&#39;) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> edFrameStep as text</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;%        str2double(get(hObject,&#39;String&#39;)) returns contents <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> edFrameStep as a <span class="keywordtype">double</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;% --- Executes during <span class="keywordtype">object</span> creation, after setting all properties.</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> edFrameStep_CreateFcn(hObject, eventdata, handles)</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;% hObject    handle to edFrameStep (see GCBO)</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;% handles    empty - handles not created until after all CreateFcns called</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;% Hint: <a class="code" href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a> controls usually have a white background on Windows.</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;%       See ISPC and COMPUTER.</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> ispc &amp;&amp; isequal(get(hObject,&#39;BackgroundColor&#39;), get(0,&#39;defaultUicontrolBackgroundColor&#39;))</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hObject,&#39;BackgroundColor&#39;,&#39;white&#39;);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;end</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;% --- Executes on button press in pbEditMask.</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> pbEditMask_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;% hObject    handle to pbEditMask (see GCBO)</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chR,&#39;value&#39;) % mask for red channel</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    % Prepearing image</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>( handles.<a class="code" href="_pike_reader_8m.html#aec2eeebd8d646ee2ebc719f72c9c7347">cF</a>(:,:,1) );</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    ha = get(hf,&#39;CurrentAxes&#39;);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    hold(ha,&#39;on&#39;);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    plot(ha,get(handles.<a class="code" href="_pike_reader_8m.html#a698dc751c8784604904c64b677c04a3f">hl</a>(1),&#39;xdata&#39;),...</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    % Start to drawing <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <a class="code" href="_pike_reader_8m.html#af4be304c83f888a0a39ed37c6f930fa3">h</a> = impoly(ha,handles.R_position); % Create draggable, resizable polygon</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    position = wait(<a class="code" href="_pike_reader_8m.html#af4be304c83f888a0a39ed37c6f930fa3">h</a>);</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <a class="code" href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a>(hf);</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    % mask from aperture</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    % compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks  for red channel</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a2aedde79552f40449090018d231fa562">BWR</a> = Bw1.*Bw2;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    handles.R_position = position; % coord handles for mascksinates <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;end</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chG,&#39;value&#39;) % mask for green channel</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    % Prepearing image</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>( handles.cF(:,:,2) );</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    ha = get(hf,&#39;CurrentAxes&#39;);</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    hold(ha,&#39;on&#39;);</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        get(handles.hl(4),&#39;ydata&#39;),&#39;<a class="code" href="_set_system_8m.html#a86bdec0d61a48a8ca4da1674058837cc">g</a>&#39;);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    % Start to drawing <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    h = impoly(ha,handles.G_position); % Create draggable, resizable polygon</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    position = wait(h);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <a class="code" href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a>(hf);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    % mask from aperture</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    % compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks  for red channel</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a2f93ba66296f970945973536ac7bfa87">BWG</a> = Bw1.*Bw2;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    handles.G_position = position; % coord handles for mascksinates <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;end</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chB,&#39;value&#39;) % mask for blue channel</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    % Prepearing image</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>( handles.cF(:,:,3) );</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    ha = get(hf,&#39;CurrentAxes&#39;);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    hold(ha,&#39;on&#39;);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    % Start to drawing <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    h = impoly(ha,handles.B_position); % Create draggable, resizable polygon</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    position = wait(h);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <a class="code" href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a>(hf);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    % mask from aperture</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    % compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks  for red channel</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#ada0d3b3c6dbb4f469da7e20a519437fd">BWB</a> = Bw1.*Bw2;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    handles.B_position = position; % coord handles for mascksinates <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;end</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;% --- Executes on button press in pbSetMask.</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160; <a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> pbSetMask_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;% hObject    handle to pbSetMask (see GCBO)</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;% Setting the mask </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chR,&#39;value&#39;) % mask for red channel</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    % Prepearing image</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>( handles.cF(:,:,1),[0 <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(handles.cF(:,:,1)))/3] );</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hf,&#39;name&#39;,&#39;Set Mask for Red channel!&#39;)</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    ha = get(hf,&#39;CurrentAxes&#39;);</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    hold(ha,&#39;on&#39;);</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    plot(ha,get(handles.hl(1),&#39;xdata&#39;),...</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        get(handles.hl(1),&#39;ydata&#39;),&#39;r&#39;);</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    % Start to drawing <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    h = impoly(ha); % Create draggable, resizable polygon</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    position = wait(h);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <a class="code" href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a>(hf);</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    % mask from aperture</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    % compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks  for red channel</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a2aedde79552f40449090018d231fa562">BWR</a> = Bw1.*Bw2;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    handles.R_position = position; % coord handles for mascksinates <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;end</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;   </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chG,&#39;value&#39;) % mask for green channel</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    % Prepearing image</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>( handles.cF(:,:,2),[0 <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(handles.cF(:,:,2)))/3] );</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hf,&#39;name&#39;,&#39;Set Mask for Green channel!&#39;)</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    ha = get(hf,&#39;CurrentAxes&#39;);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    hold(ha,&#39;on&#39;);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    plot(ha,get(handles.hl(4),&#39;xdata&#39;),...</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        get(handles.hl(4),&#39;ydata&#39;),&#39;g&#39;);</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    % Start to drawing <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    h = impoly(ha); % Create draggable, resizable polygon</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    position = wait(h);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <a class="code" href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a>(hf);</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    % mask from aperture</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    % compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks  for red channel</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#a2f93ba66296f970945973536ac7bfa87">BWG</a> = Bw1.*Bw2;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    handles.G_position = position; % coord handles for mascksinates <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;end</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chB,&#39;value&#39;) % mask for blue channel</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    % Prepearing image</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>( handles.cF(:,:,3),[0 <a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(<a class="code" href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a>(handles.cF(:,:,3)))/3] );</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <a class="code" href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a>(hf,&#39;name&#39;,&#39;Set Mask for Blue channel!&#39;)</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    ha = get(hf,&#39;CurrentAxes&#39;);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    hold(ha,&#39;on&#39;);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    plot(ha,get(handles.hl(7),&#39;xdata&#39;),...</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        get(handles.hl(7),&#39;ydata&#39;),&#39;b&#39;);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    % Start to drawing <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    h = impoly(ha); % Create draggable, resizable polygon</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    position = wait(h);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <a class="code" href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a>(hf);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    Bw1 = roipoly(handles.cF(:,:,1),[position(:,1).&#39; position(1,1)],[position(:,2).&#39; position(1,2)]);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    % mask from aperture</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    Bw2 = roipoly(handles.cF(:,:,1),get(handles.hl(1),&#39;xdata&#39;),get(handles.hl(1),&#39;ydata&#39;));</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    % compound <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> masks  for red channel</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    handles.<a class="code" href="_pike_reader_8m.html#ada0d3b3c6dbb4f469da7e20a519437fd">BWB</a> = Bw1.*Bw2;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    handles.B_position = position; % coord handles for mascksinates <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> mask</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;end</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;   </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;   </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;% --------------------------------------------------------------------</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> Untitled_1_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;% hObject    handle to Untitled_1 (see GCBO)</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;% --------------------------------------------------------------------</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> muIntCon_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;% hObject    handle to muIntCon (see GCBO)</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chR,&#39;value&#39;)</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        Frame = handles.cF(:,:,1);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a>=&#39;Red Frame&#39;;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;         hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(Frame);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>(<a class="code" href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a>);</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a>;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <a class="code" href="_pike_reader_8m.html#a627e20db9e96bdd9b52fb1f131fb5cd4">mesh</a>(Frame);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>(s);</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    end</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chG,&#39;value&#39;)</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        Frame = handles.cF(:,:,2);</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        s=&#39;Green Frame&#39;;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;         hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(Frame);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>(s);</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a>;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <a class="code" href="_pike_reader_8m.html#a627e20db9e96bdd9b52fb1f131fb5cd4">mesh</a>(Frame);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>(s);</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    end</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> get(handles.chB,&#39;value&#39;)</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        Frame = handles.cF(:,:,3);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        s=&#39;Blue Frame&#39;;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;         hf = <a class="code" href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a>(Frame);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>(s);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a>;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <a class="code" href="_pike_reader_8m.html#a627e20db9e96bdd9b52fb1f131fb5cd4">mesh</a>(Frame);</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <a class="code" href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a>(s);</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    end</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;% --------------------------------------------------------------------</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> muCros_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;% hObject    handle to muCros (see GCBO)</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;% --------------------------------------------------------------------</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> muFitModel_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;% hObject    handle to muFitModel (see GCBO)</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">N</a> = 2e2;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a> = <a class="code" href="_pike_reader_8m.html#aaa03ee2d9c5e52d9a5afa7b300071b6f">BorderCreation</a>(hObject,handles);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;% <a class="code" href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a>;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;% get only the part <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> border points </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<a class="code" href="_pike_reader_8m.html#afc718730e782c562dbdd8cbdda84fb46">Vb</a> = (1 + handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">N</a> ) : handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">N</a> * 2;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;IM = <a class="code" href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a>(480,640);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;Dw = linspace(-handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#aab586b8a47f2968cfaee012c8f55fb04">dW</a>/2,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.dW/2,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.N);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;Dh = linspace(-handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.<a class="code" href="_set_system_8m.html#a483471d881ab668d2b0837db0515bfb3">dH</a>/2,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.dH/2,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.N);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;VH = linspace(handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.dH/2,-handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.dH/2,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>.N);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;% </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;% I0 = sind(linspace(0,4*360,5500)).^2;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<a class="code" href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">hwb</a> = waitbar(0,&#39;Computation <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> intensity <a class="code" href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a> ...&#39;);</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;InSurph = zeros(length(VH), length(<a class="code" href="_pike_reader_8m.html#afc718730e782c562dbdd8cbdda84fb46">Vb</a>),3);</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;OutSurph = InSurph;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;for <a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 1 : length(VH)    % The movement across <a class="code" href="_pike_reader_8m.html#a2e13bf91d03a85943c3365be0dc8173a">Z</a> axis</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    waitbar(<a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/length(Dw),<a class="code" href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">hwb</a>)</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    for <a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 1 : length(Vb) % The movement across curved border</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <a class="code" href="_pike_reader_8m.html#abce4d39eb0932a7a185d66f28b529a9b">Pd</a> = [ <a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(Vb(<a class="code" href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>),1), <a class="code" href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a>(Vb(j),2), VH(<a class="code" href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>) ]; % toczka na kraju diafragmy</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a> = RayTracing(<a class="code" href="_pike_reader_8m.html#abce4d39eb0932a7a185d66f28b529a9b">Pd</a>,handles.<a class="code" href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a>);</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;         <a class="code" href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a> <a class="code" href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a>(<a class="code" href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a>,1) == 7</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            InSurph(i,j,:) = Pd;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            OutSurph(i,j,:) = P(7,:);</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;         end</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    end</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;end</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<a class="code" href="_pike_reader_8m.html#a1e9b0febbb137ecc9c2e2a5c34f66184">close</a>(<a class="code" href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">hwb</a>)</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;% --- Executes on button press in checkbox6.</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<a class="code" href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a> checkbox6_Callback(hObject, eventdata, handles)</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;% hObject    handle to checkbox6 (see GCBO)</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;% eventdata  reserved - to be defined in a future version <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> MATLAB</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;% handles    structure with handles and user data (see GUIDATA)</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;% Hint: get(hObject,&#39;Value&#39;) returns toggle state <a class="code" href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a> checkbox6</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;handles.<a class="code" href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a>=get(hObject,&#39;Value&#39;);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<a class="code" href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a>(hObject,handles);</div>
<div class="ttc" id="_pike_reader_8m_html_a24d4e446a6c7ef27023343f01fd3fc80"><div class="ttname"><a href="_pike_reader_8m.html#a24d4e446a6c7ef27023343f01fd3fc80">PHIT</a></div><div class="ttdeci">PHIT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00414">PikeReader.m:414</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a1123044b2487d93ac4f2068652cbfb8c"><div class="ttname"><a href="_pike_reader_8m.html#a1123044b2487d93ac4f2068652cbfb8c">IC</a></div><div class="ttdeci">IC</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00374">PikeReader.m:374</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a700ca319326cbf8fb66c2949e1040ece"><div class="ttname"><a href="_pike_reader_8m.html#a700ca319326cbf8fb66c2949e1040ece">size</a></div><div class="ttdeci">if size(P, 1)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a620c5047f94fcde614026a5718963c8b"><div class="ttname"><a href="_pike_reader_8m.html#a620c5047f94fcde614026a5718963c8b">TshY</a></div><div class="ttdeci">handles TshY</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00046">PikeReader.m:46</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a8219f7d88c4c815a7225a11f8fc48597"><div class="ttname"><a href="_pike_reader_8m.html#a8219f7d88c4c815a7225a11f8fc48597">PXXT</a></div><div class="ttdeci">PXXT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00416">PikeReader.m:416</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_af94b494535f1086dd38596a1744365b5"><div class="ttname"><a href="_pike_reader_8m.html#af94b494535f1086dd38596a1744365b5">ICT</a></div><div class="ttdeci">ICT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00412">PikeReader.m:412</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a66b9fe71b5a03cdf31bf5b618afcd369"><div class="ttname"><a href="_pike_reader_8m.html#a66b9fe71b5a03cdf31bf5b618afcd369">RG</a></div><div class="ttdeci">RG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00482">PikeReader.m:482</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_af5dee50ba772d5ac68d4ef025c90b653"><div class="ttname"><a href="_pike_reader_8m.html#af5dee50ba772d5ac68d4ef025c90b653">RT</a></div><div class="ttdeci">RT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00415">PikeReader.m:415</a></div></div>
<div class="ttc" id="demosaic__mw_8m_html_acb95449a94688af33f6e9bb090cf2936"><div class="ttname"><a href="demosaic__mw_8m.html#acb95449a94688af33f6e9bb090cf2936">R</a></div><div class="ttdeci">R</div><div class="ttdef"><b>Definition:</b> <a href="demosaic__mw_8m_source.html#l00004">demosaic_mw.m:4</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ae660a59db33c82726ca3ce78227f36b0"><div class="ttname"><a href="_pike_reader_8m.html#ae660a59db33c82726ca3ce78227f36b0">hwb</a></div><div class="ttdeci">Where Nom is a number of rays that walk into cell hwb</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00430">PikeReader.m:430</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a3691308f2a4c2f6983f2880d32e29c84"><div class="ttname"><a href="_pike_reader_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a></div><div class="ttdeci">s</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00431">PikeReader.m:431</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a29ecbdb426abecbcedbd450486d5ded2"><div class="ttname"><a href="_pike_reader_8m.html#a29ecbdb426abecbcedbd450486d5ded2">KA6</a></div><div class="ttdeci">KA6</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00368">PikeReader.m:368</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aacb7ffe70f967ddf46cb014f96bafd80"><div class="ttname"><a href="_pike_reader_8m.html#aacb7ffe70f967ddf46cb014f96bafd80">inf</a></div><div class="ttdeci">inf</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00503">PikeReader.m:503</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_afe64baaef30e37f64cb283b533dd6e8f"><div class="ttname"><a href="_pike_reader_8m.html#afe64baaef30e37f64cb283b533dd6e8f">left</a></div><div class="ttdeci">left(or right) border V</div></div>
<div class="ttc" id="_pike_reader_8m_html_a8819ca81ee58682f9892c4891a536615"><div class="ttname"><a href="_pike_reader_8m.html#a8819ca81ee58682f9892c4891a536615">THETAG</a></div><div class="ttdeci">THETAG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00480">PikeReader.m:480</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_adb6132df0fb2f5a14569df7e2c5394e1"><div class="ttname"><a href="_pike_reader_8m.html#adb6132df0fb2f5a14569df7e2c5394e1">LH</a></div><div class="ttdeci">handles LH</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00314">PikeReader.m:314</a></div></div>
<div class="ttc" id="_ray_tracing_8m_html_a415c5c5d1f49ee2db2762c80067a9bdc"><div class="ttname"><a href="_ray_tracing_8m.html#a415c5c5d1f49ee2db2762c80067a9bdc">cosd</a></div><div class="ttdeci">cosd(al2)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a3b98e2dffc6cb06a89dcb0d5c60a0206"><div class="ttname"><a href="_pike_reader_8m.html#a3b98e2dffc6cb06a89dcb0d5c60a0206">A</a></div><div class="ttdeci">A</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00242">PikeReader.m:242</a></div></div>
<div class="ttc" id="_calculate__m_8m_html_a5a182ddedd82ee46f83d0aca23119410"><div class="ttname"><a href="_calculate__m_8m.html#a5a182ddedd82ee46f83d0aca23119410">BK7</a></div><div class="ttdeci">BK7</div><div class="ttdef"><b>Definition:</b> <a href="_calculate__m_8m_source.html#l00001">Calculate_m.m:1</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a241bee448f7831627b9de6c106d81b05"><div class="ttname"><a href="_pike_reader_8m.html#a241bee448f7831627b9de6c106d81b05">PXYG</a></div><div class="ttdeci">PXYG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00476">PikeReader.m:476</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a5b2ed5ea2e1cb5d4cbbfab8a4366ed76"><div class="ttname"><a href="_pike_reader_8m.html#a5b2ed5ea2e1cb5d4cbbfab8a4366ed76">V2</a></div><div class="ttdeci">directing vector from origin to point V2</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00268">PikeReader.m:268</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_afc718730e782c562dbdd8cbdda84fb46"><div class="ttname"><a href="_pike_reader_8m.html#afc718730e782c562dbdd8cbdda84fb46">Vb</a></div><div class="ttdeci">Vb</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00373">PikeReader.m:373</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aefc58e2aa2fcd319de777ecd3067fdd9"><div class="ttname"><a href="_pike_reader_8m.html#aefc58e2aa2fcd319de777ecd3067fdd9">response</a></div><div class="ttdeci">UIWAIT makes PikeReader wait for user response(see UIRESUME)%uiwait(handles.Fig1)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a0c5581292ad1231b0c279aa0e16f09d9"><div class="ttname"><a href="_pike_reader_8m.html#a0c5581292ad1231b0c279aa0e16f09d9">Frame</a></div><div class="ttdeci">handles to imshow object Frame</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00041">PikeReader.m:41</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ab0f73a4b0e20ffee1dff4c2e0add81c0"><div class="ttname"><a href="_pike_reader_8m.html#ab0f73a4b0e20ffee1dff4c2e0add81c0">isempty</a></div><div class="ttdeci">end If there is no then show the empty frame if isempty(handles.hImSh) if isempty(handles.fn) handles.hImSh</div></div>
<div class="ttc" id="_pike_reader_8m_html_ad79aa7d5e6e37e487edfcc745e3f3c88"><div class="ttname"><a href="_pike_reader_8m.html#ad79aa7d5e6e37e487edfcc745e3f3c88">loss</a></div><div class="ttdeci">The calculation of energy loss</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00448">PikeReader.m:448</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ac86694252f8dfdb19aaeadc4b7c342c6"><div class="ttname"><a href="_pike_reader_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a></div><div class="ttdeci">for j</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00435">PikeReader.m:435</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a530bb7ddd78e17e99edcc4d0186a7aca"><div class="ttname"><a href="_pike_reader_8m.html#a530bb7ddd78e17e99edcc4d0186a7aca">GPU</a></div><div class="ttdeci">handles GPU</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00055">PikeReader.m:55</a></div></div>
<div class="ttc" id="_ray_tracing_8m_html_aeab71244afb687f16d8c4f5ee9d6ef0e"><div class="ttname"><a href="_ray_tracing_8m.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div><div class="ttdeci">return end normal vector to the surface n</div><div class="ttdef"><b>Definition:</b> <a href="_ray_tracing_8m_source.html#l00036">RayTracing.m:36</a></div></div>
<div class="ttc" id="_calculate__m_8m_html_a0e1e60135616bfcf405ade0573890884"><div class="ttname"><a href="_calculate__m_8m.html#a0e1e60135616bfcf405ade0573890884">if</a></div><div class="ttdeci">if((0&lt;=Temperature)&amp;&amp;(Temperature&lt;=40))%Thiesen formula for 0-40 degC from Tanaka b1</div></div>
<div class="ttc" id="_pike_reader_8m_html_a3b1f2de14b8a6c0b78d815e608e45a8a"><div class="ttname"><a href="_pike_reader_8m.html#a3b1f2de14b8a6c0b78d815e608e45a8a">KA2</a></div><div class="ttdeci">KA2</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00364">PikeReader.m:364</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a6c439a155daf0cb0377815c02e9cf72b"><div class="ttname"><a href="_pike_reader_8m.html#a6c439a155daf0cb0377815c02e9cf72b">gui_State</a></div><div class="ttdeci">gui_State</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00009">PikeReader.m:9</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a9298037979afd4748a15c04dbf4dad7b"><div class="ttname"><a href="_pike_reader_8m.html#a9298037979afd4748a15c04dbf4dad7b">mex</a></div><div class="ttdeci">clear mex</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00089">PikeReader.m:89</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a3cb4559b90e7cbf954590f076bdbed81"><div class="ttname"><a href="_pike_reader_8m.html#a3cb4559b90e7cbf954590f076bdbed81">Ka3</a></div><div class="ttdeci">Ka3</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00454">PikeReader.m:454</a></div></div>
<div class="ttc" id="_calculate__m_8m_html_a08a4415e9d594ff960030b921d42b91e"><div class="ttname"><a href="_calculate__m_8m.html#a08a4415e9d594ff960030b921d42b91e">e</a></div><div class="ttdeci">e</div><div class="ttdef"><b>Definition:</b> <a href="_calculate__m_8m_source.html#l00243">Calculate_m.m:243</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a926d91594e8da5b03c46b755b6cb75d0"><div class="ttname"><a href="_pike_reader_8m.html#a926d91594e8da5b03c46b755b6cb75d0">zeros</a></div><div class="ttdeci">4 *handles.S.N, 3 zeros()</div></div>
<div class="ttc" id="_ray_tracing_8m_html_ae4d665bafab09a5b5d0dc55e888edea8"><div class="ttname"><a href="_ray_tracing_8m.html#ae4d665bafab09a5b5d0dc55e888edea8">norm</a></div><div class="ttdeci">Point in the plane parallel to the flat surface of the lens if norm([P3(end, 2), P3(end, 3)]) &gt;(S.efD/2)%verification whether the point inside the aperture of the lens or not%perescitywajem koordinaty Kp</div></div>
<div class="ttc" id="_pike_reader_8m_html_ac2529c9aa0e86fba892de797e252c223"><div class="ttname"><a href="_pike_reader_8m.html#ac2529c9aa0e86fba892de797e252c223">Cdata</a></div><div class="ttdeci">end else if Cdata</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00155">PikeReader.m:155</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aaa53ca0b650dfd85c4f59fa156f7a2cc"><div class="ttname"><a href="_pike_reader_8m.html#aaa53ca0b650dfd85c4f59fa156f7a2cc">C</a></div><div class="ttdeci">C</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00244">PikeReader.m:244</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a9d0c75b43300c189035103c63a8aeb08"><div class="ttname"><a href="_pike_reader_8m.html#a9d0c75b43300c189035103c63a8aeb08">dzieje</a></div><div class="ttdeci">pojawia si dziwny crash matlaba dla koloru niebieskiego na SPICA y nie udao mi si go odtworzy zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu nie wiem dlaczego tak si dzieje</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00380">PikeReader.m:380</a></div></div>
<div class="ttc" id="_ray_tracing_8m_html_a9564846b4818d9eed8b0e902c97b942d"><div class="ttname"><a href="_ray_tracing_8m.html#a9564846b4818d9eed8b0e902c97b942d">sum</a></div><div class="ttdeci">V.^2 sum()</div></div>
<div class="ttc" id="_set_system_8m_html_a86bdec0d61a48a8ca4da1674058837cc"><div class="ttname"><a href="_set_system_8m.html#a86bdec0d61a48a8ca4da1674058837cc">g</a></div><div class="ttdeci">id g()</div></div>
<div class="ttc" id="_pike_reader_8m_html_a2f9cb71a5dadd05cb10a4b34b09130a0"><div class="ttname"><a href="_pike_reader_8m.html#a2f9cb71a5dadd05cb10a4b34b09130a0">Bt1</a></div><div class="ttdeci">directing vector from origin to point Bt1</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00269">PikeReader.m:269</a></div></div>
<div class="ttc" id="_set_system_8m_html_a3a198b0beef1d35ec220ce7a338f39bc"><div class="ttname"><a href="_set_system_8m.html#a3a198b0beef1d35ec220ce7a338f39bc">of</a></div><div class="ttdeci">lens diametr Set instead of(real aperture) is convenient for calculations S.efD</div></div>
<div class="ttc" id="_pike_reader_8m_html_aa329f5d1d9f4a435327c228671eb52f7"><div class="ttname"><a href="_pike_reader_8m.html#aa329f5d1d9f4a435327c228671eb52f7">PXZG</a></div><div class="ttdeci">PXZG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00478">PikeReader.m:478</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ac4ca50a39233ee7f03b0e8ec074a7be0"><div class="ttname"><a href="_pike_reader_8m.html#ac4ca50a39233ee7f03b0e8ec074a7be0">KA4</a></div><div class="ttdeci">KA4</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00366">PikeReader.m:366</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aadd84b46ee6d2e3ae04d2920f4e78bfd"><div class="ttname"><a href="_pike_reader_8m.html#aadd84b46ee6d2e3ae04d2920f4e78bfd">drawnow</a></div><div class="ttdeci">drawnow</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00092">PikeReader.m:92</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ad17d63e56d09c69bd3c90b4d0296f93d"><div class="ttname"><a href="_pike_reader_8m.html#ad17d63e56d09c69bd3c90b4d0296f93d">PXZ</a></div><div class="ttdeci">PXZ</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00403">PikeReader.m:403</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a7de0a9938c22cb89998f4b33689f73a5"><div class="ttname"><a href="_pike_reader_8m.html#a7de0a9938c22cb89998f4b33689f73a5">save</a></div><div class="ttdeci">save('compT.mat','ICT','THETAT','PHIT','RT','PXXT','PXYT','PXZT','ICNNT')</div></div>
<div class="ttc" id="nvmex__helper_8m_html_a52e3417805be73af234040a44925af06"><div class="ttname"><a href="nvmex__helper_8m.html#a52e3417805be73af234040a44925af06">elseif</a></div><div class="ttdeci">elseif(errCode~=0) errorStruct.identifier</div></div>
<div class="ttc" id="_pike_reader_8m_html_a627e20db9e96bdd9b52fb1f131fb5cd4"><div class="ttname"><a href="_pike_reader_8m.html#a627e20db9e96bdd9b52fb1f131fb5cd4">mesh</a></div><div class="ttdeci">mesh(double(IC))</div></div>
<div class="ttc" id="_pike_reader_8m_html_aa9c19988f200a79e3fa5bf1f1dd3d816"><div class="ttname"><a href="_pike_reader_8m.html#aa9c19988f200a79e3fa5bf1f1dd3d816">PHI</a></div><div class="ttdeci">end PHI</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00355">PikeReader.m:355</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a08dc1a08a766f17149e25935eb560cde"><div class="ttname"><a href="_pike_reader_8m.html#a08dc1a08a766f17149e25935eb560cde">PXY</a></div><div class="ttdeci">PXY</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00400">PikeReader.m:400</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a1e9b0febbb137ecc9c2e2a5c34f66184"><div class="ttname"><a href="_pike_reader_8m.html#a1e9b0febbb137ecc9c2e2a5c34f66184">close</a></div><div class="ttdeci">end close(hwb)%Normalisation of Intesity matrix%ICNNG</div></div>
<div class="ttc" id="_pike_reader_8m_html_abf9d47cd7d4fbc942e618bb1977019c2"><div class="ttname"><a href="_pike_reader_8m.html#abf9d47cd7d4fbc942e618bb1977019c2">ii</a></div><div class="ttdeci">for ii</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00317">PikeReader.m:317</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a4624ad09721d379eb37b97070c9259c4"><div class="ttname"><a href="_pike_reader_8m.html#a4624ad09721d379eb37b97070c9259c4">PX</a></div><div class="ttdeci">PX</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00375">PikeReader.m:375</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aa656899df1f8926fc8507851b84bf381"><div class="ttname"><a href="_pike_reader_8m.html#aa656899df1f8926fc8507851b84bf381">KA3</a></div><div class="ttdeci">KA3</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00365">PikeReader.m:365</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a6547474af60ce2b5078438090a689969"><div class="ttname"><a href="_pike_reader_8m.html#a6547474af60ce2b5078438090a689969">Hi1</a></div><div class="ttdeci">Hi1(i)</div></div>
<div class="ttc" id="_pike_reader_8m_html_af4be304c83f888a0a39ed37c6f930fa3"><div class="ttname"><a href="_pike_reader_8m.html#af4be304c83f888a0a39ed37c6f930fa3">h</a></div><div class="ttdeci">else if there isn t sum of then draws current frame instead h</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00105">PikeReader.m:105</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ab7d639bee69ea566d05c15438d20ceaf"><div class="ttname"><a href="_pike_reader_8m.html#ab7d639bee69ea566d05c15438d20ceaf">ICNNT</a></div><div class="ttdeci">ICNNT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00387">PikeReader.m:387</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_af5e7b6b3888b7ff1427978d360412fe7"><div class="ttname"><a href="_pike_reader_8m.html#af5e7b6b3888b7ff1427978d360412fe7">pause</a></div><div class="ttdeci">pause(0.1)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a9d3d9048db16a7eee539e93e3618cbe7"><div class="ttname"><a href="_pike_reader_8m.html#a9d3d9048db16a7eee539e93e3618cbe7">B</a></div><div class="ttdeci">B</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00243">PikeReader.m:243</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ab9f9228dbcac2043ba4424e683ffc8b6"><div class="ttname"><a href="_pike_reader_8m.html#ab9f9228dbcac2043ba4424e683ffc8b6">shLW</a></div><div class="ttdeci">handles shLW</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00049">PikeReader.m:49</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aed35f423ca9aba8635f1fd5e4df75a65"><div class="ttname"><a href="_pike_reader_8m.html#aed35f423ca9aba8635f1fd5e4df75a65">shY</a></div><div class="ttdeci">handles shY</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00047">PikeReader.m:47</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aec2eeebd8d646ee2ebc719f72c9c7347"><div class="ttname"><a href="_pike_reader_8m.html#aec2eeebd8d646ee2ebc719f72c9c7347">cF</a></div><div class="ttdeci">handles cF</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00042">PikeReader.m:42</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aa75144726b375b93ecfc08810e5b5f09"><div class="ttname"><a href="_pike_reader_8m.html#aa75144726b375b93ecfc08810e5b5f09">args</a></div><div class="ttdeci">see VARARGOUT args()</div></div>
<div class="ttc" id="_pike_reader_8m_html_ad1367ffd245743f6db78ce58d9d877c4"><div class="ttname"><a href="_pike_reader_8m.html#ad1367ffd245743f6db78ce58d9d877c4">VBt</a></div><div class="ttdeci">VBt</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00271">PikeReader.m:271</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a82faae35904886280b7daa434030bd47"><div class="ttname"><a href="_pike_reader_8m.html#a82faae35904886280b7daa434030bd47">set</a></div><div class="ttdeci">set(handles.edAperture,'string', num2str(handles.S.D))</div></div>
<div class="ttc" id="_pike_reader_8m_html_ad7d8756ffc9df06bb6bb864280ffc5d3"><div class="ttname"><a href="_pike_reader_8m.html#ad7d8756ffc9df06bb6bb864280ffc5d3">Ka1</a></div><div class="ttdeci">The calculation of energy caused by reflection on lens surfaces and rising distance Ka1</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00450">PikeReader.m:450</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a905c521e05ec8042631a912b71d0454e"><div class="ttname"><a href="_pike_reader_8m.html#a905c521e05ec8042631a912b71d0454e">temp</a></div><div class="ttdeci">temp</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00106">PikeReader.m:106</a></div></div>
<div class="ttc" id="_set_system_8m_html_aab586b8a47f2968cfaee012c8f55fb04"><div class="ttname"><a href="_set_system_8m.html#aab586b8a47f2968cfaee012c8f55fb04">dW</a></div><div class="ttdeci">Distance to second diaphragm First Diaphragm S dW</div><div class="ttdef"><b>Definition:</b> <a href="_set_system_8m_source.html#l00027">SetSystem.m:27</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a58f7f5bb8af524fdfac53ec31e329e3f"><div class="ttname"><a href="_pike_reader_8m.html#a58f7f5bb8af524fdfac53ec31e329e3f">gui_mainfcn</a></div><div class="ttdeci">else gui_mainfcn(gui_State, varargin{:})</div></div>
<div class="ttc" id="nvmex__helper_8m_html_afa10fc9bba65211f5c19b788a8059b15"><div class="ttname"><a href="nvmex__helper_8m.html#afa10fc9bba65211f5c19b788a8059b15">delete</a></div><div class="ttdeci">failure end delete(rspfile)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a4e41918df3b734cb20355ce9ca8ab336"><div class="ttname"><a href="_pike_reader_8m.html#a4e41918df3b734cb20355ce9ca8ab336">macierz</a></div><div class="ttdeci">pojawia si dziwny crash matlaba dla koloru niebieskiego na SPICA y nie udao mi si go odtworzy zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu nie wiem dlaczego tak si ale moe by to bug w matlabie czy promie nie wyszed poza macierz[IC, PX]</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00383">PikeReader.m:383</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a21c04a4f36a8c81d06fe6c34ef0ebd32"><div class="ttname"><a href="_pike_reader_8m.html#a21c04a4f36a8c81d06fe6c34ef0ebd32">guidata</a></div><div class="ttdeci">Update handles structure guidata(hObject, handles)</div></div>
<div class="ttc" id="_pike_reader_8m_html_ab52db955259a3fd3904e2eeac8aeea17"><div class="ttname"><a href="_pike_reader_8m.html#ab52db955259a3fd3904e2eeac8aeea17">W1</a></div><div class="ttdeci">else Terminate the rays that don t hit the CCD element W1(i)</div></div>
<div class="ttc" id="_set_system_8m_html_a483471d881ab668d2b0837db0515bfb3"><div class="ttname"><a href="_set_system_8m.html#a483471d881ab668d2b0837db0515bfb3">dH</a></div><div class="ttdeci">width of diaphragm S dH</div><div class="ttdef"><b>Definition:</b> <a href="_set_system_8m_source.html#l00028">SetSystem.m:28</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a012f41a4e178ac7e193a1a250962f349"><div class="ttname"><a href="_pike_reader_8m.html#a012f41a4e178ac7e193a1a250962f349">V1</a></div><div class="ttdeci">V1</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00267">PikeReader.m:267</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ae2a5d275fbf66f7d42d0be6057027d49"><div class="ttname"><a href="_pike_reader_8m.html#ae2a5d275fbf66f7d42d0be6057027d49">ICG</a></div><div class="ttdeci">ICG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00479">PikeReader.m:479</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a67860ef9c6dd010302334f9c5a53f7b3"><div class="ttname"><a href="_pike_reader_8m.html#a67860ef9c6dd010302334f9c5a53f7b3">uiwait</a></div><div class="ttdeci">uiwait(h)</div></div>
<div class="ttc" id="_pike_reader_8m_html_add07a252dc3f8e8cc0dac2890c4e6fac"><div class="ttname"><a href="_pike_reader_8m.html#add07a252dc3f8e8cc0dac2890c4e6fac">sF</a></div><div class="ttdeci">handles sF</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00038">PikeReader.m:38</a></div></div>
<div class="ttc" id="demosaic__c__mex_8c_html_a60ef6e1bcfabb95cfeb300e1d03ce470"><div class="ttname"><a href="demosaic__c__mex_8c.html#a60ef6e1bcfabb95cfeb300e1d03ce470">I</a></div><div class="ttdeci">#define I</div><div class="ttdef"><b>Definition:</b> <a href="demosaic__c__mex_8c_source.html#l00005">demosaic_c_mex.c:5</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_af93dd7f73e57b8b17d34efa33f0f948e"><div class="ttname"><a href="_pike_reader_8m.html#af93dd7f73e57b8b17d34efa33f0f948e">P1</a></div><div class="ttdeci">P1</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00319">PikeReader.m:319</a></div></div>
<div class="ttc" id="_set_system_8m_html_a141992195c618a3c78b87ed867206a34"><div class="ttname"><a href="_set_system_8m.html#a141992195c618a3c78b87ed867206a34">PixSize</a></div><div class="ttdeci">height of CCD[Pix] S PixSize</div><div class="ttdef"><b>Definition:</b> <a href="_set_system_8m_source.html#l00036">SetSystem.m:36</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a9349b39d3b86ed6b44272d93479cb559"><div class="ttname"><a href="_pike_reader_8m.html#a9349b39d3b86ed6b44272d93479cb559">CCDW</a></div><div class="ttdeci">height of CCD handles S CCDW</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00215">PikeReader.m:215</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a57f52176cbb01e0b7e665e2a5f1df4ee"><div class="ttname"><a href="_pike_reader_8m.html#a57f52176cbb01e0b7e665e2a5f1df4ee">N</a></div><div class="ttdeci">drawing the additional symetrical lines handles N</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00313">PikeReader.m:313</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a51d4a2ecbc1a31c6a187269dae7c1ef9"><div class="ttname"><a href="_pike_reader_8m.html#a51d4a2ecbc1a31c6a187269dae7c1ef9">FIXME</a></div><div class="ttdeci">end calculates intensity correction matrix for experimental data Creation of electrode border FIXME</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00355">PikeReader.m:355</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a3956b937b791b918837824f48ee12586"><div class="ttname"><a href="_pike_reader_8m.html#a3956b937b791b918837824f48ee12586">L</a></div><div class="ttdeci">handles L</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00315">PikeReader.m:315</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aa873351ac7745f560c49f5d18d1f02f1"><div class="ttname"><a href="_pike_reader_8m.html#aa873351ac7745f560c49f5d18d1f02f1">ChKey</a></div><div class="ttdeci">handles ChKey</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00167">PikeReader.m:167</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a53323a4c01bdc9e45b28410b296cb054"><div class="ttname"><a href="_pike_reader_8m.html#a53323a4c01bdc9e45b28410b296cb054">fn</a></div><div class="ttdeci">handles fn</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00037">PikeReader.m:37</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a49103af439b2008e321ec99ae26e7001"><div class="ttname"><a href="_pike_reader_8m.html#a49103af439b2008e321ec99ae26e7001">edit</a></div><div class="ttdeci">pojawia si dziwny crash matlaba dla koloru niebieskiego na SPICA y nie udao mi si go odtworzy zakomentowana linijka ze zmienionym zakresem nie powoduje tego bdu nie wiem dlaczego tak si ale moe by to bug w matlabie edit</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00380">PikeReader.m:380</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a698703b15037a73ef893d58e89410e1f"><div class="ttname"><a href="_pike_reader_8m.html#a698703b15037a73ef893d58e89410e1f">alpha</a></div><div class="ttdeci">vector of border points calculation of position for the outer points alpha</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00230">PikeReader.m:230</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_adca714bf61ad7fb2fc07053ed7c43d40"><div class="ttname"><a href="_pike_reader_8m.html#adca714bf61ad7fb2fc07053ed7c43d40">m2</a></div><div class="ttdeci">handles S m2</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00166">PikeReader.m:166</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a835accca41274fb237599d9b3c117fcf"><div class="ttname"><a href="_pike_reader_8m.html#a835accca41274fb237599d9b3c117fcf">off</a></div><div class="ttdeci">hold off</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00150">PikeReader.m:150</a></div></div>
<div class="ttc" id="_avi_read_pike___split_8m_html_a53be3e8a3476298b0e2ca95e4fa573fc"><div class="ttname"><a href="_avi_read_pike___split_8m.html#a53be3e8a3476298b0e2ca95e4fa573fc">file</a></div><div class="ttdeci">This is a matlab script which needs avimex MEX file The code was successfully used in Linux Mint with Matlab and Windows bit with Matlab It s used to read a multiframe avi video from AVT PIKE DS filter x frames INPUT First argument is a name of input file(including.avi extension)</div></div>
<div class="ttc" id="_pike_reader_8m_html_acc5fdf94db2193839902773727d92486"><div class="ttname"><a href="_pike_reader_8m.html#acc5fdf94db2193839902773727d92486">THETAT</a></div><div class="ttdeci">THETAT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00413">PikeReader.m:413</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a9a1bbf30810d9fbcda4b4d7806f3d145"><div class="ttname"><a href="_pike_reader_8m.html#a9a1bbf30810d9fbcda4b4d7806f3d145">PXXG</a></div><div class="ttdeci">PXXG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00474">PikeReader.m:474</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a2f93ba66296f970945973536ac7bfa87"><div class="ttname"><a href="_pike_reader_8m.html#a2f93ba66296f970945973536ac7bfa87">BWG</a></div><div class="ttdeci">handles BWG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00052">PikeReader.m:52</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a7ab10073dde4b253ad2f8fead0e352b8"><div class="ttname"><a href="_pike_reader_8m.html#a7ab10073dde4b253ad2f8fead0e352b8">KA1</a></div><div class="ttdeci">Number of points per side KA1</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00363">PikeReader.m:363</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ada0d3b3c6dbb4f469da7e20a519437fd"><div class="ttname"><a href="_pike_reader_8m.html#ada0d3b3c6dbb4f469da7e20a519437fd">BWB</a></div><div class="ttdeci">handles BWB</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00053">PikeReader.m:53</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aa5f24e3c374443eb088c7f52723fe6bc"><div class="ttname"><a href="_pike_reader_8m.html#aa5f24e3c374443eb088c7f52723fe6bc">title</a></div><div class="ttdeci">wywietlamy na panelu nazwe filmu if title</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00500">PikeReader.m:500</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a833e4ada184974774f52b322638e55eb"><div class="ttname"><a href="_pike_reader_8m.html#a833e4ada184974774f52b322638e55eb">toc</a></div><div class="ttdeci">toc[IC, PX]</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00385">PikeReader.m:385</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a2aedde79552f40449090018d231fa562"><div class="ttname"><a href="_pike_reader_8m.html#a2aedde79552f40449090018d231fa562">BWR</a></div><div class="ttdeci">handles for masks handles BWR</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00051">PikeReader.m:51</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a39cc09955543dcd51a20e72fca0d9428"><div class="ttname"><a href="_pike_reader_8m.html#a39cc09955543dcd51a20e72fca0d9428">P</a></div><div class="ttdeci">Points on the diaphragm plane P</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00296">PikeReader.m:296</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aaa03ee2d9c5e52d9a5afa7b300071b6f"><div class="ttname"><a href="_pike_reader_8m.html#aaa03ee2d9c5e52d9a5afa7b300071b6f">BorderCreation</a></div><div class="ttdeci">hObject, handles BorderCreation()</div></div>
<div class="ttc" id="_calculate__m_8m_html_a620c273b62a1f455230fe4c42528ff31"><div class="ttname"><a href="_calculate__m_8m.html#a620c273b62a1f455230fe4c42528ff31">function</a></div><div class="ttdeci">function[m]</div><div class="ttdef"><b>Definition:</b> <a href="_calculate__m_8m_source.html#l00001">Calculate_m.m:1</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a8fb092330ecda60587643305d0d9738a"><div class="ttname"><a href="_pike_reader_8m.html#a8fb092330ecda60587643305d0d9738a">tic</a></div><div class="ttdeci">tic</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00376">PikeReader.m:376</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a30a0ec962623a193eb6832214fb3c4d8"><div class="ttname"><a href="_pike_reader_8m.html#a30a0ec962623a193eb6832214fb3c4d8">max</a></div><div class="ttdeci">max(IC)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a597c256ab63e46a3b384d171dc07e24c"><div class="ttname"><a href="_pike_reader_8m.html#a597c256ab63e46a3b384d171dc07e24c">PXZT</a></div><div class="ttdeci">PXZT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00418">PikeReader.m:418</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aabc621035b24273abc351729676cf921"><div class="ttname"><a href="_pike_reader_8m.html#aabc621035b24273abc351729676cf921">W</a></div><div class="ttdeci">shifting of mask position according experimental data W</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00439">PikeReader.m:439</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a972c98ca59d4bab0dafff435513cdbb4"><div class="ttname"><a href="_pike_reader_8m.html#a972c98ca59d4bab0dafff435513cdbb4">clear</a></div><div class="ttdeci">clear('avimex_Split')</div></div>
<div class="ttc" id="_pike_reader_8m_html_a5fbc4fbf26631ee45e428d05d93fee86"><div class="ttname"><a href="_pike_reader_8m.html#a5fbc4fbf26631ee45e428d05d93fee86">Bt2</a></div><div class="ttdeci">Bt2</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00270">PikeReader.m:270</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aec57c8145e51accce560df6ba86c5795"><div class="ttname"><a href="_pike_reader_8m.html#aec57c8145e51accce560df6ba86c5795">PHIG</a></div><div class="ttdeci">PHIG</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00481">PikeReader.m:481</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ad51c447b242fd7b0935d39a878faf3cb"><div class="ttname"><a href="_pike_reader_8m.html#ad51c447b242fd7b0935d39a878faf3cb">point</a></div><div class="ttdeci">end end Recalculation meters to pixels shifting the origin to middle of the image The center of image isn t placed on[0, 0] point</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00308">PikeReader.m:308</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a85b8167c96f99aa3837bc38e9bf96eb3"><div class="ttname"><a href="_pike_reader_8m.html#a85b8167c96f99aa3837bc38e9bf96eb3">LW</a></div><div class="ttdeci">handles LW</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00048">PikeReader.m:48</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ac43bc603dfb3c49e15db8ef3c46f4316"><div class="ttname"><a href="_pike_reader_8m.html#ac43bc603dfb3c49e15db8ef3c46f4316">handles</a></div><div class="ttdeci">handles</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00061">PikeReader.m:61</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a2c21aa3b460e6fdf20b31a7a9cb73686"><div class="ttname"><a href="_pike_reader_8m.html#a2c21aa3b460e6fdf20b31a7a9cb73686">PXYT</a></div><div class="ttdeci">PXYT</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00417">PikeReader.m:417</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ac0055fa4cdc19a2690bfee3643413a7d"><div class="ttname"><a href="_pike_reader_8m.html#ac0055fa4cdc19a2690bfee3643413a7d">V</a></div><div class="ttdeci">V</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00240">PikeReader.m:240</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a8eed6a862fd2641ec716c25d5426b728"><div class="ttname"><a href="_pike_reader_8m.html#a8eed6a862fd2641ec716c25d5426b728">lambda</a></div><div class="ttdeci">end end If sight checkbox is active then draw theoretical image if value handles S lambda</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00165">PikeReader.m:165</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ad30dfa987bf399e9d5c8256815544151"><div class="ttname"><a href="_pike_reader_8m.html#ad30dfa987bf399e9d5c8256815544151">Ka4</a></div><div class="ttdeci">Ka4</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00456">PikeReader.m:456</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a33cb10e751a17a81c39b07c9dc1710ae"><div class="ttname"><a href="_pike_reader_8m.html#a33cb10e751a17a81c39b07c9dc1710ae">calculation</a></div><div class="ttdeci">Angles calculation[THETA, PHI, R]</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00471">PikeReader.m:471</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a8ed6ac5cbd6e13e4eadfda44f8d995b8"><div class="ttname"><a href="_pike_reader_8m.html#a8ed6ac5cbd6e13e4eadfda44f8d995b8">CCDH</a></div><div class="ttdeci">handles S CCDH</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00214">PikeReader.m:214</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_adbb3dedcc987c432a0facce1bdf57cb5"><div class="ttname"><a href="_pike_reader_8m.html#adbb3dedcc987c432a0facce1bdf57cb5">THETA</a></div><div class="ttdeci">end THETA</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00355">PikeReader.m:355</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a7ca9388205808cde238c5d87083a3f02"><div class="ttname"><a href="_pike_reader_8m.html#a7ca9388205808cde238c5d87083a3f02">path</a></div><div class="ttdeci">end If there is no path</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00128">PikeReader.m:128</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_abce4d39eb0932a7a185d66f28b529a9b"><div class="ttname"><a href="_pike_reader_8m.html#abce4d39eb0932a7a185d66f28b529a9b">Pd</a></div><div class="ttdeci">Pd</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00323">PikeReader.m:323</a></div></div>
<div class="ttc" id="_avi_read_pike___split_8m_html_ae22ae49fb36f2b7372aefce186887619"><div class="ttname"><a href="_avi_read_pike___split_8m.html#ae22ae49fb36f2b7372aefce186887619">matrix</a></div><div class="ttdeci">This is a matlab script which needs avimex MEX file The code was successfully used in Linux Mint with Matlab and Windows bit with Matlab It s used to read a multiframe avi video from AVT PIKE DS filter x frames INPUT First argument is a name of input Second is a vector of frames to be read OUTPUT Outup is a dimensional matrix(no of frame, height, width, RGB) of%uint16 numbers.%%Without specifying the second argument the script is run from the begining%to the end of the input file.%%Script uses Matlab built-in demosaic function applied to the RAW 16 frames%read frame by frame by avimex MEX file.%Beware that the transposition function is used</div></div>
<div class="ttc" id="_pike_reader_8m_html_ae700af75f7c86d41107aff520471f509"><div class="ttname"><a href="_pike_reader_8m.html#ae700af75f7c86d41107aff520471f509">t</a></div><div class="ttdeci">t</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00246">PikeReader.m:246</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a77daacf149ab4ea47290c71d79d2c783"><div class="ttname"><a href="_pike_reader_8m.html#a77daacf149ab4ea47290c71d79d2c783">functions</a></div><div class="ttdeci">My functions</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00079">PikeReader.m:79</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a580628da7b9cb7e817437cacb89c8300"><div class="ttname"><a href="_pike_reader_8m.html#a580628da7b9cb7e817437cacb89c8300">Ka2</a></div><div class="ttdeci">Ka2</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00452">PikeReader.m:452</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a7a344eb254d5f989a285b2afbb5e10d9"><div class="ttname"><a href="_pike_reader_8m.html#a7a344eb254d5f989a285b2afbb5e10d9">mov</a></div><div class="ttdeci">else mov</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00086">PikeReader.m:86</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_ade5833a0a85b9b718569df8e6db987da"><div class="ttname"><a href="_pike_reader_8m.html#ade5833a0a85b9b718569df8e6db987da">TshX</a></div><div class="ttdeci">handles TshX</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00044">PikeReader.m:44</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_abdb0d19a8959793169aa443f82d9fdb3"><div class="ttname"><a href="_pike_reader_8m.html#abdb0d19a8959793169aa443f82d9fdb3">PXX</a></div><div class="ttdeci">PXX</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00395">PikeReader.m:395</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a9008b30888cfe384af56bc71d2714dc1"><div class="ttname"><a href="_pike_reader_8m.html#a9008b30888cfe384af56bc71d2714dc1">Br</a></div><div class="ttdeci">Number of points per side Br</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00422">PikeReader.m:422</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a12877197daf0d7622b4e2a822dc68461"><div class="ttname"><a href="_pike_reader_8m.html#a12877197daf0d7622b4e2a822dc68461">imtool</a></div><div class="ttdeci">imtool(IC)</div></div>
<div class="ttc" id="_pike_reader_8m_html_ad9f3db92a52f842eedc8c5d5d8cb63d3"><div class="ttname"><a href="_pike_reader_8m.html#ad9f3db92a52f842eedc8c5d5d8cb63d3">frame</a></div><div class="ttdeci">else if there isn t sum of frame</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00104">PikeReader.m:104</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a2e13bf91d03a85943c3365be0dc8173a"><div class="ttname"><a href="_pike_reader_8m.html#a2e13bf91d03a85943c3365be0dc8173a">Z</a></div><div class="ttdeci">Z(1)</div></div>
<div class="ttc" id="_pike_reader_8m_html_ad53a3643d8e9b1a361e497398d3d238c"><div class="ttname"><a href="_pike_reader_8m.html#ad53a3643d8e9b1a361e497398d3d238c">S</a></div><div class="ttdeci">handles S</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00043">PikeReader.m:43</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_aae1d1bec0e9c36c2fddc5cd87d8c4eee"><div class="ttname"><a href="_pike_reader_8m.html#aae1d1bec0e9c36c2fddc5cd87d8c4eee">ischar</a></div><div class="ttdeci">if nargin &amp;&amp; ischar(varargin{1}) gui_State.gui_Callback</div></div>
<div class="ttc" id="_set_system_8m_html_a5af87bd8e9f0f9596eb498ecbf2914c3"><div class="ttname"><a href="_set_system_8m.html#a5af87bd8e9f0f9596eb498ecbf2914c3">Pk</a></div><div class="ttdeci">width of CCD Droplet position S Pk</div><div class="ttdef"><b>Definition:</b> <a href="_set_system_8m_source.html#l00040">SetSystem.m:40</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a698dc751c8784604904c64b677c04a3f"><div class="ttname"><a href="_pike_reader_8m.html#a698dc751c8784604904c64b677c04a3f">hl</a></div><div class="ttdeci">handles hl</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00039">PikeReader.m:39</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a350bfcb1e3cfb28ddff48ce525d4f139"><div class="ttname"><a href="_pike_reader_8m.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a></div><div class="ttdeci">D</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00245">PikeReader.m:245</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a6f6ccfcf58b31cb6412107d9d5281426"><div class="ttname"><a href="_pike_reader_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a></div><div class="ttdeci">ray tracing calculation for i</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00294">PikeReader.m:294</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a3c6a1673d3a361dfaace22b908b602d4"><div class="ttname"><a href="_pike_reader_8m.html#a3c6a1673d3a361dfaace22b908b602d4">munlock</a></div><div class="ttdeci">munlock('avimex_Split')</div></div>
<div class="ttc" id="_pike_reader_8m_html_a7ecaf384ab87923ea947dbb29e4e4fa9"><div class="ttname"><a href="_pike_reader_8m.html#a7ecaf384ab87923ea947dbb29e4e4fa9">f</a></div><div class="ttdeci">end f</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00485">PikeReader.m:485</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_acc89f64219ddae53243030f2c645fc06"><div class="ttname"><a href="_pike_reader_8m.html#acc89f64219ddae53243030f2c645fc06">varargout</a></div><div class="ttdeci">function varargout</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00001">PikeReader.m:1</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a146cbfe4fb22ea0e92b3b2e8836e4b3d"><div class="ttname"><a href="_pike_reader_8m.html#a146cbfe4fb22ea0e92b3b2e8836e4b3d">get</a></div><div class="ttdeci">Choosing the channel of observation if get(handles.chR,'value') Frame(end if get(handles.chG,'value') Frame(end if get(handles.chB,'value') Frame(end Correction of the level of intensity if get(handles.chAdjust,'value') Frame</div></div>
<div class="ttc" id="_pike_reader_8m_html_a6e69a2e6c16546a1aba75e0422487e55"><div class="ttname"><a href="_pike_reader_8m.html#a6e69a2e6c16546a1aba75e0422487e55">hObject</a></div><div class="ttdeci">see VARARGIN hObject()</div></div>
<div class="ttc" id="_pike_reader_8m_html_ad890cb44dd0cf10657a62ee68206c497"><div class="ttname"><a href="_pike_reader_8m.html#ad890cb44dd0cf10657a62ee68206c497">avi_title</a></div><div class="ttdeci">handles avi_title</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00501">PikeReader.m:501</a></div></div>
<div class="ttc" id="_ray_tracing_8m_html_aee34fc740f3a5271508e6499ce2e3326"><div class="ttname"><a href="_ray_tracing_8m.html#aee34fc740f3a5271508e6499ce2e3326">X</a></div><div class="ttdeci">posledniaja toczka eto P5 X</div><div class="ttdef"><b>Definition:</b> <a href="_ray_tracing_8m_source.html#l00097">RayTracing.m:97</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a38085a9efe80800b5ff4a73688322798"><div class="ttname"><a href="_pike_reader_8m.html#a38085a9efe80800b5ff4a73688322798">KA5</a></div><div class="ttdeci">KA5</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00367">PikeReader.m:367</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a9b07119da70fc4a54e0d1cb5751d69aa"><div class="ttname"><a href="_pike_reader_8m.html#a9b07119da70fc4a54e0d1cb5751d69aa">nargout</a></div><div class="ttdeci">end if nargout[varargout{1:nargout}]</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00020">PikeReader.m:20</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a7e55b80aae57454b1b0353641cb67b33"><div class="ttname"><a href="_pike_reader_8m.html#a7e55b80aae57454b1b0353641cb67b33">Hi</a></div><div class="ttdeci">Hi</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00440">PikeReader.m:440</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a3640ad397933061adc052c623140eef9"><div class="ttname"><a href="_pike_reader_8m.html#a3640ad397933061adc052c623140eef9">R1</a></div><div class="ttdeci">end end Recalculation meters to pixels shifting the origin to middle of the image The center of image isn t placed on[0, 0] but on[240, 320] point handles R1(1,:)</div></div>
<div class="ttc" id="_pike_reader_8m_html_a903dc30acce65e0358386b3e2e59d2ef"><div class="ttname"><a href="_pike_reader_8m.html#a903dc30acce65e0358386b3e2e59d2ef">shX</a></div><div class="ttdeci">handles shX</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00045">PikeReader.m:45</a></div></div>
<div class="ttc" id="_set_system_8m_html_a92194e0fd585cf13a4a3b76420356158"><div class="ttname"><a href="_set_system_8m.html#a92194e0fd585cf13a4a3b76420356158">R_dis_Ring</a></div><div class="ttdeci">Distance between center of the trap and first diaphragm S R_dis_Ring</div><div class="ttdef"><b>Definition:</b> <a href="_set_system_8m_source.html#l00020">SetSystem.m:20</a></div></div>
<div class="ttc" id="_pike_reader_8m_html_a391e34f2de441d79152a7b3d6e4c9c86"><div class="ttname"><a href="_pike_reader_8m.html#a391e34f2de441d79152a7b3d6e4c9c86">figure</a></div><div class="ttdeci">figure</div><div class="ttdef"><b>Definition:</b> <a href="_pike_reader_8m_source.html#l00392">PikeReader.m:392</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_382e95b3446a02a720633edac7014b11.html">RayTracingCUDA_TJ</a></li><li class="navelem"><a class="el" href="_pike_reader_8m.html">PikeReader.m</a></li>
    <li class="footer">Wygenerowano So, 7 maj 2016 15:31:34 dla PikeReaderCUDA_TJ programem
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
